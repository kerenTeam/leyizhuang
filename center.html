<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>个人中心</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="css/center.css"/>
		<link rel="stylesheet" type="text/css" href="css/configW.css"/>
		<style type="text/css">
			body {
				margin: 0;
			}

			body::-webkit-scrollbar {
				/*滚动条*/
				width: 0!important;
				height: 0!important;
				opacity: 1!important;
			}
			.white {
				color: #FFFFFF !important;
				width: 100%;
			}
			.myInfo {
				width: 70px;
			    height: 70px;
			    margin: 4% 6%;
				border-radius: 50%;
				border: 2px solid rgba(255, 255, 255, 0.7);
			}

			.denlu {
				font-size: 15px;
			}

			/*修改*/
			.denlu {
				/*padding-left: 20px;*/
				color: #fff;
				line-height: 25px;
			}
			.writing {
				padding: 33px 0 5px;
				padding-bottom: 5px;
				margin-left: -25px;
			}
			#userBox {
				background-color: #eca4a6;
				padding: 33px 0 17px;
				position: relative;
			}
			.dao {
				color: white!important;
				border-color: white;
				padding: 1px 7px;
				top: 10px;
				right: 10px;
				position: absolute;
				font-size: 12px;
				border-radius: 2px;
			}
			.qiandao{
				font-size: 14px;
				border-radius: 2px;
				background: orange;
				padding:2px 10px;
				top: 66px;
				right: 10px;
				position: absolute;
			}
			.centop span {
				display: inline-block;
				padding: 4px 0;
				font-size: 14px;
			}

			#beijing {
				position: absolute;
				z-index: 10;
				width: 100%;
				height: 100%;
				top: 0;
				overflow: hidden;
				/*-webkit-filter: blur(5px);*/
			}

			#beijing img {
				width: 100%;
				position: relative;
				/*top: -40%;*/
			}

			#beijing2 {
				position: absolute;
				z-index: 20;
				width: 100%;
				height: 100%;
				top: 0;
				background-color: rgba(241, 63, 63, 0.76);
			}

			#userBox .content {
				position: relative;
				z-index: 30;
			}

			#numjifen {
				z-index: 99;
				font-weight: 500;
				padding: 0;
				line-height: 20px;
				font-size: 14px;
			}

			body {
				background-color: #f8f8f8 !important;
				width: 100%;
				overflow-x: hidden;
			}
			#fixdtop {
				position: fixed;
				top: 0;
				height: 25px;
				width: 100%;
				z-index: 100;
			}

		</style>

	</head>

	<body>
		<div class="clearfloat box-s box-ss" id="userBox">
			<div id="beijing"><img id="mypic1" src="images/center/centerBg.png"></div>
			<!--<div id="beijing2"></div>-->
			<div id="fixdtop"></div>
			<div class="content clearfloat fl mui-row white">
				<div class="mui-col-sm-4 mui-col-xs-4" style="padding-top: 28px;position: relative;left: 3px;"><img src="https://b-ssl.duitang.com/uploads/item/201710/12/20171012232816_GX5iw.thumb.224_0.jpeg" class="myInfo" id="mypic" /></div>
				<div class="mui-col-sm-8 mui-col-xs-8 writing">
					<p class="centop">
						<div class="denlu">用户名:<span id="userName" style="z-index: 99;"></span></div>
						<div class="denlu" style="display:none ;" id="userNumber">用户id:<span style="z-index: 99;"></span></div>
						<div class="denlu" id="onlyPs">配送数量：<span id="psNumber" style="z-index: 99;"></span></div>
						<div class="denlu" id="onlyGuide">手机号：<span id="guidesPhone"></span> <span id='bindPhone' style="background-color: orange;color: white;font-size: 10px;padding: 2px;border-radius: 3px;display: none;">绑定手机号</span></div>
						<div class="denlu" id="onlyCust">灯号:<span id="dengh"></span>&nbsp;&nbsp; 导购:<span id="guideName"></span><a id="guideMobile" style="display: none;" href=""><img style="width: 15px;margin-left: 5px;" src="images/center/phone.svg"/></a></div>
						<div class="denlu" id="onlymange">账户:<span id="manageMoney"></span></div>
					</p>
				</div>
				<img class="dao shezhi" style="top: 8px;width: 36px;" src="images/center/shizhi.png" />
				<div onclick="goMessage()">
					<img class="dao" style="top: 8px;width: 36px;right: 50px;" src="images/center/message.svg" />
					<span class="mui-badge mui-badge-green" style="right: 54px;position: absolute;padding: 4px;top: 8px;"></span>
				</div>

				<div class="qiandao" onclick="qian()">签到</div>
			</div>
		</div>
		<div id="customar">
			<div class="orderType">
				<div class="afterBorder bgcwt ft14" style="padding: 15px;" onclick="openOrder()">
					所有订单
					<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 activecl" style="font-weight: 800;"></span>
				</div>
				<div class="flexRow ft14">
					<div class="">
						<img src="images/center/waitPay.png"/>
						待付款
					</div>
					<div class="">
						<img src="images/center/take.png"/>
						待收货
					</div>
					<div class="">
						<img src="images/center/cmt.png"/>
						待评价
					</div>
					<div class="">
						<img src="images/center/backT.png"/>
						退货
					</div>
				</div>
			</div>

			<!--顾客-->
			<div class="centerList customerN" style="display: none;">
				<div class="walletG">
					<div class="afterBorder bgcwt ft14" style="padding: 15px;" onclick="wallet()">
						我的钱包
						<b><span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 activecl" style="font-weight: 800;"></span></b>
					</div>
					<div class="flexRow ft14">
						<div class="">
							<div id="cashCouponQty">
								---
							</div>
							<div onclick="myCoupon()">
								优惠券
							</div>
						</div>
						<div class="">
							<div id="productCouponQty">
								---
							</div>
							<div onclick="productCoupon()">
								产品券
							</div>
						</div>
						<div class="">
							<div id="userAct">
								
							</div>
							<div onclick="wallet()">
								账户余额
							</div>
						</div>
						<div class="">
							<div id="userlb">
								
							</div>
							<div onclick="lebi()">
								我的乐币
							</div>
						</div>

					</div>
				</div>

				<div class="flexRow2">
					<div class="afterBorder" onclick="goCollect()">
						<img src="images/center/collect.svg"/>商品收藏
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>

					<div class="afterBorder" onclick="openPalette()">
						<img src="images/center/color.svg"/>调色板
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="afterBorder" onclick="paizhaoOrder()">
						<img src="images/center/camer.svg"/>拍照下单
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="" onclick="lookHistory()">
						<img src="images/center/look.svg"/>浏览记录
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
				</div>
			</div>
			<!--导购-->
			<div class="centerList guiderN"  style="display: none;">
				<div class="walletG">
					<div class="afterBorder bgcwt ft14" style="padding: 15px;" onclick="guideCredit()">
						信用额度
						<b><span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 activecl" style="font-weight: 800;"></span></b>
					</div>
					<div class="flexRow ft14">
						<div class="">
							<div onclick="debateQuery()">
								欠款查询
							</div>
						</div>
						<div onclick="debateAudit()">
							<div >
								欠款审核
							</div>
						</div>
						<div onclick="qrcode()">
							<div class="">
								我的二维码
							</div>
						</div>
						<div class="">
							<div onclick="toMyCustomer()">
								我的顾客
							</div>
						</div>

					</div>
				</div>
				<div class="flexRow2">
					<div class="afterBorder" onclick="goCollect()">
						<img src="images/center/collect.svg"/>商品收藏
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>

					<div class="afterBorder" onclick="openPalette()">
						<img src="images/center/color.svg"/>调色板
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="afterBorder" onclick="paizhaoOrder()">
						<img src="images/center/camer.svg"/>拍照下单
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="" onclick="lookHistory()">
						<img src="images/center/look.svg"/>浏览记录
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
				</div>
			</div>
			<!--项目经理-->
			<div class="centerList manageN"  style="display: none;">
				<div class="walletG">
					<div class="afterBorder bgcwt ft14" style="padding: 15px;" onclick="wallet()">
						我的钱包
						<b><span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 activecl" style="font-weight: 800;"></span></b>
					</div>
					<div class="flexRow ft14">
						<div class="">
							<div onclick="backMoney()">
								信用额度
							</div>
						</div>
						<div class="">
							<div onclick="goworker()">
								工人
							</div>
						</div>
						<div class="">
							<div onclick="listCheck()">
								料单审核
							</div>
						</div>
					</div>
				</div>

				<div class="flexRow2">
					<div class="afterBorder" onclick="goCollect()">
						<img src="images/center/collect.svg"/>商品收藏
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>

					<div class="afterBorder" monclick="openPalette()">
						<img src="images/center/color.svg"/>调色板
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="afterBorder" onclick="paizhaoOrder()">
						<img src="images/center/camer.svg"/>拍照下单
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="" onclick="lookHistory()">
						<img src="images/center/look.svg"/>浏览记录
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
				</div>
			</div>
			<!--工人-->
			<div class="centerList workerN"  style="display: none;">
				<div class="flexRow2">
					<div class="afterBorder" onclick="goCollect()">
						<img src="images/center/collect.svg"/>商品收藏
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="afterBorder" onclick="goworkerMaterial()">
						<img src="images/center/material.svg"/>料单申请
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="afterBorder">
						<img src="images/center/color.svg"/>调色板
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="afterBorder" onclick="paizhaoOrder()">
						<img src="images/center/camer.svg"/>拍照下单
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div class="" onclick="lookHistory()">
						<img src="images/center/look.svg"/>浏览记录
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>


				</div>

			</div>
			<!--配送员-->
			<div class="centerList distributionN"  style="display: none;">
				<div class="flexRow2">
					<div class="afterBorder">
						<img src="images/center/backT.png"/>代收款
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
					<div>
						<img src="images/center/color.svg"/>调色板
						<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
					</div>
				</div>
			</div>
		</div>



		<script type="text/javascript">
			window.onscroll = function() {
				if(document.body.scrollTop > 25) {
					document.getElementById('fixdtop').style.backgroundColor = '#af4444';
				} else {
					document.getElementById('fixdtop').style.background = 'none';
				}
			}
		</script>
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/default.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			//调色版
			function openPalette(){
				openview({
					view:'page/personal/palette.html',
					id: 'palette',
				})
			}
			//分类订单
			function openOrder(){
				openview({
					view:'page/personal/myOrderList.html',
					id: 'myOrderList',
				})
			}
			//顾客 收藏
			function goCollect(){
				openview({
					view:'page/personal/collect.html',
					id: 'collect',
				})
			}
			//料单审核
			function listCheck(){
				openview({
					view:'page/manager/listCheck.html',
					id: 'listCheck',
				})
			}
			function qrcode(){
				openview({
					view:'page/guide/qrcode.html',
					id: 'qrcode',
				})
			}
			function debateQuery(){
				openview({
					view:'page/guide/debateQuery.html',
					id:'debateQuery'
				})
			}
			//料单申请
			function goworkerMaterial(){
				openview({
					view:'page/worker/workerlistCheck.html',
					id: 'workerlistCheck',
				})
			}
			//顾客 优惠券
			function myCoupon(){
				openview({
					view:'page/personal/myCoupon.html',
					id: 'myCoupon',
				})
			}
			// 产品券
			function productCoupon(){
				openview({
					view:'page/personal/productCoupon.html',
					id: 'productCoupon',
				})
			}
			//消息
			function goMessage(){
				openview({
					view:'page/personal/message.html',
					id: 'message',
				})
			}
            //导购->我的导购
			function toMyCustomer(){
				openview({
					view:'page/guide/myCustomer.html',
					id: 'myCustomer',
				})
			}
			//导购 欠款审核
			function debateAudit(){
				openview({
					view:'page/guide/debateAudit.html',
					id:'debateAudit'
				})
			}
			//经理-> 工人列表
			function goworker(){
				openview({
					view:'page/manager/workerList.html',
					id: 'workerList',
				})
			}
			//经理 现金返利
			function backMoney(){
				openview({
					view:'page/manager/backMoney.html',
					id: 'backMoney',
				})
			}
			//钱包
			function wallet(){
				openview({
					view: 'page/wallet.html',
					id: 'wallet',
				})
			}
			//我的乐币
			function lebi(){
				openview({
					view: 'page/personal/lebi.html',
					id: 'lebi',
				})
			}
			//导购 信用额度
			function guideCredit(){
				openview({
					view: 'page/guide/guideCredit.html',
					id: 'guideCredit',
				})
			}
			//拍照下单
			function paizhaoOrder(){
				openview({
					view: 'page/personal/pzOrderList.html',
					id: 'pzOrderList',
				})
			}
			//浏览记录
			function lookHistory(){
				openview({
					view: 'page/history.html',
					id: 'history',
				})
			}

			mui.plusReady(function() {
				document.addEventListener('refresh', function() {
					Refresh();
				})
				Refresh();
				function Refresh() { //刷新
					//获取缓存
					var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
					var userId = plus.storage.getItem('$userId');
					var oldToken = plus.storage.getItem('oldToken');
					$('.qiandao').html('签到');
					$('#mypic').attr('src','https://b-ssl.duitang.com/uploads/item/201710/12/20171012232816_GX5iw.thumb.224_0.jpeg')
					//签到
					window.qian = function(){
						mui.ajax(serverUrl+'/app/customer/sign',{
							data:{
								userId:userId,
								identityType:identityT
							},
							dataType:'json',
							headers: {"Authorization": oldToken},
							type:'post',
							timeout:10000,
							success:function(data,type,xhr){
								plus.nativeUI.closeWaiting();
								console.log('列表',data);
								if(data.code == 0 ){
									plus.nativeUI.closeWaiting();
									plus.nativeUI.toast('签到成功，增加1乐币');
									$('.qiandao').html('已签到');
									Refresh();
								}
								if(data.code == 1000 ){
									mui.toast(data.message)
								}else if(data.code == -1 ){
									mui.toast(data.message)
								}

							},
							error:function(xhr,type,errorThrown){
								plus.nativeUI.closeWaiting();
								console.log('登录响应失败');
							}
						});
					}

					loadmyinfo();
					if(identityT == 0 || identityT == 4 || identityT == 5){//导购
						$('#onlyCust,.qiandao,.centerList,#onlyPs,#onlymange').hide()
						$('#onlyGuide,.orderType,.guiderN,#userNumber').show();
					}else if(identityT == 6){//顾客
						$('#onlyGuide,#onlymange,.centerList,.centerList,#onlyPs,#userNumber').hide();
						$('#onlyCust,.orderType,.customerN,.qiandao').show()
					}else if(identityT == 3){//工人
						$('#onlyGuide,#onlyCust,.centerList,.orderType,#onlymange,.qiandao,#onlyPs').hide();
						$('.workerN,#userNumber').show();
					}else if(identityT == 2){//项目经理
						$('.centerList,#onlyGuide,#onlyCust,#onlyPs,.qiandao').hide();
						$('.orderType,.manageN,#onlymange,#userNumber').show();
					}else{//配送员
						$('.centerList,.orderType,#onlymange,#onlyCust,.qiandao').hide();
						$('.distributionN,#onlyPs,#onlyGuide,#userNumber').show();
					}

					/*设置*/
					mui('.shezhi')[0].addEventListener('tap',function(){
						openview({
							view:'page/personal/shezhi.html',
							id:'shezhi'
						});
					});

					function loadmyinfo() {
						//个人信息
						mui.ajax(serverUrl+'/app/user/homepage', {
							data: {
								userId: userId,
								identityType: identityT
							},
							dataType: 'json',
							headers: {
								"Authorization": oldToken
							},
							type: 'post',
							timeout: 10000,
							success: function(data, type, xhr) {
								console.log('个人信息', data);
								if(data.code == 0) {
									plus.nativeUI.closeWaiting();
									if(data.content) {
										if(data.content.cityId){
											plus.storage.setItem('userCity',data.content.cityId.toString())
										}
										if(!data.content.canSign){
											$('.qiandao').removeAttr('onclick').html('已签到');
										}
										if(identityT == 6){
											if(data.content.name) {
												$('#userName').html(data.content.name)
											} else {
												$('#userName').html('未填写')
											}
										}else{
											$('#userName').html(data.content.name)
											$('#userNumber span').html(data.content.number)
										}

										if(data.content.picUrl) {
											$('#mypic').attr('src', data.content.picUrl)
										}else{
											$('#mypic').attr('src', 'img/editset.png')

										}
										if(data.content.mobile) {
											plus.storage.setItem('mobile',data.content.mobile);
										}
										if(data.content.guideName) {
											$('#guideName').html(data.content.guideName)
										} else {
											$('#guideName').html('无')
										}
										if(data.content.guideMobile) {
											$('#guideMobile').css('display','inline-block').attr('href', 'tel:' + data.content.guideMobile)
										}else{
											$('#guideMobile').css('display','none')
										}
										if(data.content.light) {
											$('#dengh').html(data.content.light)
										} else {
											$('#dengh').html('无')
										}
										if(data.content.balance){
											$('#accoutMoney,#manageMoney,#userAct').html('¥'+data.content.balance)
										}else{
											$('#userAct,#accoutMoney').html(0)
										}
										if(data.content.lb){
											$('#coin,#userlb').html(data.content.lb)
										}else{
											$('#userlb').html(data.content.lb)
											$('#coin,#userlb').html(0)
										}
										if(data.content.cashCouponQty){
											$('#cashCouponQty').html(data.content.cashCouponQty)
										}
										if(data.content.productCouponQty){
											$('#productCouponQty').html(data.content.productCouponQty)
										}
										if(identityT == 0){
											if(data.content.mobile) {
												$('#bindPhone').css('display','none')
												$('#guidesPhone').html(data.content.mobile);
											}else{
												$('#guidesPhone').css('display','inline-block')
												$('#guidesPhone').html('未填写')
											}
										}
										if(identityT == 1){
											if(data.content.mobile) {
												$('#guidesPhone').html(data.content.mobile)
											}
											if(data.content.sendQty){
												$('#psNumber').html(data.content.psNumber)
											}else{
												$('#psNumber').html('0')
												
											}
										}
									}
								} else {
									mui.toast(data.message)
								}

							},
							error: function(xhr, type, errorThrown) {
								plus.nativeUI.closeWaiting();
								console.log('登录响应失败');
							}
						});


					}
				} //刷新
			});
			var backButtonPress = 0;
			mui.back = function(event) {
				backButtonPress++;
				if(backButtonPress > 1) {
					plus.runtime.quit();
				} else {
					plus.nativeUI.toast('再按一次退出应用');
				}
				setTimeout(function() {
					backButtonPress = 0;
				}, 1000);
				return false;
			};
		</script>

	</body>

</html>