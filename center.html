<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>个人中心</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="css/center.css"/>
		<style type="text/css">
			body {
				margin: 0;
			}
			
			body::-webkit-scrollbar {
				/*滚动条*/
				width: 0!important;
				height: 0!important;
				opacity: 1!important;
			}
			.white {
				color: #FFFFFF !important;
				width: 100%;
			}
			
			.myInfo {
				width: 85px;
				height: 85px;
				margin: 0 6%;
				border-radius: 50%;
				border: 2px solid #fff;
			}
			
			.denlu {
				font-size: 15px;
			}
			
			/*修改*/
			.denlu {
				/*padding-left: 20px;*/
				color: #fff;
				line-height: 25px;
			}
			.writing {
				padding: 5px 0;
				padding-bottom: 5px;
			}
			#userBox {
				background-color: #eca4a6;
				padding: 35px 0 12px;
				position: relative;
			}
			.dao {
				color: white!important;
				border-color: white;
				padding: 1px 7px;
				top: 10px;
				right: 10px;
				position: absolute;
				font-size: 12px;
				border-radius: 2px;
			}
			.qiandao{
				font-size: 12px;
				border-radius: 2px;
				background: orange;
				padding: 2px 8px;
				top: 45px;
				right: 10px;
				position: absolute;
			}
			.centop span {
				display: inline-block;
				padding: 4px 0;
				font-size: 14px;
			}
			
			#beijing {
				position: absolute;
				z-index: 10;
				width: 100%;
				height: 100%;
				top: 0;
				overflow: hidden;
				-webkit-filter: blur(5px);
			}
			
			#beijing img {
				width: 100%;
				position: relative;
				top: -40%;
			}
			
			#beijing2 {
				position: absolute;
				z-index: 20;
				width: 100%;
				height: 100%;
				top: 0;
				background-color: rgba(241, 63, 63, 0.76);
			}
			
			#userBox .content {
				position: relative;
				z-index: 30;
			}
			
			#numjifen {
				z-index: 99;
				font-weight: 500;
				padding: 0;
				line-height: 20px;
				font-size: 14px;
			}
			
			body {
				background-color: #f8f8f8 !important;
				width: 100%;
				overflow-x: hidden;
			}
			#fixdtop {
				position: fixed;
				top: 0;
				height: 25px;
				width: 100%;
				z-index: 100;
			}
		</style>

	</head>

	<body>
		<div class="clearfloat box-s box-ss" id="userBox">
			<!--src="img/morentouxiang.jpg"/-->
			<div id="beijing"><img id="mypic1" src="https://b-ssl.duitang.com/uploads/item/201710/12/20171012232816_GX5iw.thumb.224_0.jpeg"></div>
			<div id="beijing2"></div>
			<div id="fixdtop"></div>
			<div class="content clearfloat fl mui-row white">
				<div class="mui-col-sm-4 mui-col-xs-4" style="padding-top: 18px;position: relative;left: 3px;"><img src="https://b-ssl.duitang.com/uploads/item/201710/12/20171012232816_GX5iw.thumb.224_0.jpeg" class="myInfo" id="mypic" /></div>
				<div class="mui-col-sm-8 mui-col-xs-8 writing">
					<p class="centop">
						<div class="denlu">用户名：<span id="userName" style="z-index: 99;"></span></div>
						<div class="denlu" id="onlyPs">配送数量：<span id="psNumber" style="z-index: 99;"></span></div>
						<div class="denlu" id="onlyGuide">手机号：<span id="guidesPhone"></span> <span id='bindPhone' style="background-color: orange;color: white;font-size: 10px;padding: 2px;border-radius: 3px;display: none;">绑定手机号</span></div> 
						<div class="denlu" id="onlyCust">乐币:<span id="coin"></span> 账户:<span id="accoutMoney"></span><br />灯号:<span id="dengh"></span> 导购:<span id="guideName"></span><a id="guideMobile" style="display: none;" href=""><img style="width: 15px;margin-left: 5px;" src="images/center/phone.svg"/></a></div>
						<div class="denlu" id="onlymange">账户:<span id="manageMoney"></span></div>
					</p>
				</div>
				<img class="dao shezhi" style="top: 8px;width: 30px;" src="images/center/shizhi.png" />
				<div class="qiandao">签到</div>
			</div>
		</div>
		<div id="customar">
			<div class="orderType flexRow">
				<div class="">
					待付款
				</div>
				<div class="">
					待收货
				</div>
				<div class="">
					待评价
				</div>
				<div class="">
					退货
				</div>
				<div class="">
					所有订单
				</div>
			</div>
			<!--顾客-->
			<div class="centerList customerN" style="display: none;">
				<div class="flexRow2">
					<div class="" onclick="goCollect()">
						商品收藏
					</div>
					<div class="">
						客服
					</div>
					<div class="">
						调色板
					</div>
					<div class="" onclick="goMessage()">
						消息
					</div>
					<div class="">
						设置
					</div> 
					<div onclick="myCoupon()">
						优惠券
					</div>
					<div onclick="productCoupon()">
						产品券
					</div>
					<div class="">
						我的钱包
					</div>
					<div class="">
						我的乐豆
					</div>
					<div >
						拍照下单
					</div>
				</div>
			</div>
			<!--导购-->
			<div class="centerList guiderN"  style="display: none;">
				<div class="flexRow2">
					<div class="" onclick="goCollect()">
						商品收藏
					</div>
					<div class="">
						客服
					</div>
					<div class="">
						调色板
					</div>
					<div class="" onclick="goMessage()">
						消息
					</div>
					<div class="">
						设置
					</div> 
					<div onclick="toMyCustomer()">
						我的顾客
					</div>
					<div class="">
						信用额度
					</div>
					<div class="">
						欠款查询
					</div>
					<div class="">
						我的二维码
					</div>
					<div >
						欠款审核
					</div>
					<div>
						拍照下单
					</div>
					<div style="visibility: hidden;">
						ccc
					</div>
				</div>
			</div>
			<!--项目经理-->
			<div class="centerList manageN"  style="display: none;">
				<div class="flexRow2">
					<div class="" onclick="goCollect()">
						商品收藏
					</div>
					<div class="">
						客服
					</div>
					<div class="">
						调色板
					</div>
					<div class="" onclick="goMessage()">
						消息
					</div>
					<div class="">
						设置
					</div> 
					<div onclick="">
						料单审核
					</div>
					<div onclick="goworker()">
						工人
					</div>
					<div class="">
						我的钱包
					</div>
					<div class="">
						信用金
					</div>
					<div >
						现金返利
					</div>
					<div>
						拍照下单
					</div>
					<div style="visibility: hidden;">
						ccc
					</div>
				</div>
			</div>
			<!--工人-->
			<div class="centerList workerN"  style="display: none;">
				<div class="flexRow2">
					<div class="" onclick="goCollect()">
						商品收藏
					</div>
					<div class="">
						调色板
					</div>
					<div class="">
						科单申请
					</div>
					<div class="">
						拍照下单
					</div>
				</div>
			</div>
			<!--配送员-->
			<div class="centerList distributionN"  style="display: none;">
				<div class="flexRow2">
					<div class="">
						代收款
					</div>
					<div class="">
						调色板
					</div>
				</div>
			</div>
		</div>
		
		
		
		<script type="text/javascript">
			window.onscroll = function() {
				if(document.body.scrollTop > 25) {
					document.getElementById('fixdtop').style.backgroundColor = '#af4444';
				} else {
					document.getElementById('fixdtop').style.background = 'none';
				}
			}
		</script>
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			//分类订单
			function typeOrder(type) {
			}
			//顾客 收藏
			function goCollect(){
				openview({
					view:'page/personal/collect.html',
					id: 'collect', 
				}) 
			}
			//顾客 优惠券
			function myCoupon(){
				openview({
					view:'page/personal/myCoupon.html',
					id: 'myCoupon', 
				})
			}
			// 产品券
			function productCoupon(){
				openview({
					view:'page/personal/productCoupon.html',
					id: 'productCoupon', 
				})
			}
			//消息
			function goMessage(){
				openview({
					view:'page/personal/message.html',
					id: 'message', 
				}) 
			}
            //导购->我的导购
			function toMyCustomer(){
				openview({
					view:'page/guide/myCustomer.html',
					id: 'myCustomer', 
				}) 
			}
			//经理-> 工人列表
			function goworker(){
				openview({
					view:'page/manager/workerList.html',
					id: 'workerList', 
				})
			}

			mui.plusReady(function() {
				document.addEventListener('refresh', function() {
					Refresh();
				}) 
				Refresh();
				function Refresh() { //刷新
					//获取缓存 
					var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
					var userId = plus.storage.getItem('$userId'); 
					var oldToken = plus.storage.getItem('oldToken');
					loadmyinfo();
					if(identityT == 0 || identityT == 4 || identityT == 5){//导购
						$('#onlyCust,.qiandao,.centerList,#onlyPs,#onlymange').css('display','none')
						$('#onlyGuide,.orderType,.guiderN').css('display','');
					}else if(identityT == 6){//顾客
						$('#onlyGuide,#onlymange,.centerList,.qiandao,.centerList,#onlyPs').css('display','none');
						$('#onlyCust,.orderType,.customerN,.qiandao').css('display','')						
					}else if(identityT == 3){//工人
						$('#onlyGuide,#onlyCust,.centerList,.orderType,#onlymange,.qiandao,#onlyPs').css('display','none');
						$('.workerN').css('display','block'); 
					}else if(identityT == 2){//项目经理
						$('.centerList,#onlyGuide,#onlyCust,#onlyPs').css('display','none');
						$('.orderType,.manageN,#onlymange').css('display','');
					}else{//配送员
						$('.centerList,.orderType,#onlymange,#onlyCust').css('display','none');
						$('.distributionN,#onlyPs,#onlyGuide').css('display','');
					}
					
					/*设置*/
					mui('.shezhi')[0].addEventListener('tap',function(){
						openview({
							view:'page/personal/shezhi.html',
							id:'shezhi'
						});
					});

					function loadmyinfo() {
						//个人信息
						mui.ajax('http://119.23.149.7:9999/app/user/homepage', {
							data: {
								userId: userId,
								identityType: identityT
							},
							dataType: 'json',
							headers: {
								"Authorization": oldToken
							},
							type: 'post',
							timeout: 10000,
							success: function(data, type, xhr) {
								console.log('个人信息', data);
								if(data.code == 0) {
									plus.nativeUI.closeWaiting();
									if(data.content) {
										if(identityT == 6){
											if(data.content.name) {
												$('#userName').html(data.content.name)
											} else {
												$('#userName').html('未填写')
											}
										}else{
											$('#userName').html(data.content.number)
										}
										
										if(data.content.picUrl) {
											$('#mypic').attr('src', data.content.picUrl)
										}
										if(data.content.picUrl) {
											$('#mypic').attr('src', data.content.picUrl)
										}
										if(data.content.guideName) {
											$('#guideName').html(data.content.guideName)
										} else {
											$('#guideName').html('无')
										}
										if(data.content.guideMobile) {
											$('#guideMobile').css('display','inline-block').attr('href', 'tel:' + data.content.guideMobile)
										}else{
											$('#guideMobile').css('display','none')
										}
										if(data.content.light) {
											$('#dengh').html(data.content.light)
										} else {
											$('#dengh').html('无')
										}
										if(data.content.balance){
											$('#accoutMoney').html('¥'+data.content.balance)
											$('#manageMoney').html('¥'+data.content.balance)
										}else{
											$('#accoutMoney').html(0)
										}
										if(data.content.lb){
											$('#coin').html(data.content.lb)
										}else{
											$('#coin').html(0)
										}
										if(identityT == 0){
											if(data.content.guideMobile) {
												$('#bindPhone').css('display','none')
												$('#guidesPhone').html(data.content.guideMobile);
											}else{
												$('#guidesPhone').css('display','inline-block')
												$('#guidesPhone').html('未填写')
											}
										}
									}
								} else {
									mui.toast(data.message)
								}

							},
							error: function(xhr, type, errorThrown) {
								plus.nativeUI.closeWaiting();
								mui.toast(type)
								console.log('登录响应失败');
							}
						});
						

					}
				} //刷新	
			});
		</script>

	</body>

</html>