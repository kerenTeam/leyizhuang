<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>选择顾客</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/commonY.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/configW.css"/>
	</head>
	<style type="text/css">
		#bindPhone{border: none;}
		#bindGuide{font-size: 16px;height: 44px;line-height: 14px;position: fixed;bottom: 10px;left: 5%;width: 90%;}
	</style>
	<body>
		<header class="mui-bar mui-bar-nav" style="padding-right: 15px;">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">选择顾客</h1>
		</header>
		<script src="../../js/statusBar.js" type="text/javascript" charset="utf-8"></script>
		<div class="mui-content" >
			<div style="padding:10px 0;display: flex;align-items: center;justify-content: space-between;margin: 10px 0;" class="bgcwt">
				<input type="text" id="bindPhone" style="width: 80%;margin: 0;" placeholder="请输入会员手机号" />
				<!--<div style="border-left: 1px solid #EEEEEE;padding: 0 10px;">通讯录</div>-->
			</div>
			<div style="text-align: center;">
				<button class="mui-btn-block mui-btn-danger" id="bindGuide">为该顾客代购</button>
			</div>
		</div>
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/default.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function(){
				var reg_phone = /^1((3|4|5|8|7){1}\d{1}|70)\d{8}$/;//手机号正则;
				var account = $('#bindPhone');
				//获取缓存
				var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
				var userId = plus.storage.getItem('$userId');
				var oldToken = plus.storage.getItem('oldToken');

				$('#bindGuide').click(function(){

					if(!reg_phone.test(account.val())){
							mui.toast('请输入正确的手机号')

					}else{

						mui.ajax(serverUrl + '/app/user/search/customer', {
							data: {
								userId: userId,
								keywords: account.val(),
								identityType:identityT
							},
							dataType: 'json',
							headers: {
								"Authorization": oldToken
							},
							type: 'post',
							timeout: 10000,
							success: function(data, type, xhr) {
								plus.nativeUI.closeWaiting();
								console.log('查找返回', data);
								if(data.code == 0) {
									plus.nativeUI.closeWaiting();
									if(data.content){
											mui.confirm('null', '你的会员是'+data.content[0].name, ['取消','确认'], function(e) {
												if(e.index == 1) {
													openview({
														view:'chooseGift.html',
														id:'chooseGift',
														extrasobj:{cusId:data.content[0].cusId}
													})
												}
												return;
											},'')

									}else{
										plus.nativeUI.alert('会员不存在')
									}
								}else{
									mui.toast(data.message)
								}

							},
							error: function(xhr, type, errorThrown) {
								plus.nativeUI.closeWaiting();
								mui.toast(type)
							}
						});
					}

				})

			})


		</script>
	</body>

</html>