<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>我的订单详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/configW.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/commonY.css">
		<link rel="stylesheet" type="text/css" href="../../css/indexY.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/resetY.css">
		<link rel="stylesheet" href="../../css/feedback.css"><!--订单星级-->
		<link rel="stylesheet" href="../../css/youxd.css">
		<script src="../../js/order0.js"></script>
		<style type="text/css">
			/*去支付样式*/
			#maskInfo { z-index: 99999; position: fixed; top: 0; left: 0;width: 100%;bottom: 0;background-color: rgba(0, 0, 0, .5)}
			.paychoose {background-color: white;bottom: 0!important;position: absolute; right: 0; left: 0; }
			.paychoose img { width: 40px; margin: 0 5px; }
			/*去支付样式结束*/
			body{background-color: #F8F9FA;font-size: 15px;}
			#main{margin-top: 49px;padding-bottom: 10px;}
			.cancelBtn button {margin-right: 15px;margin-left: 0;}
			.cancelBtn {text-align: right;}
			/*图片组件*/
			.disbg{border:none}
			.uppics div.onepic input{width:0;height:0;position:absolute;outline:0}
			#fangshi{background-color: #eee;padding-top: 8px;}
			.mui-checkbox, .mui-radio { display: inline-block;}
			#fangshi span{line-height: 40px;float: left;}
			.dizhis{padding: 10px;background-color: #ccc;}
			.dizhis div{padding:  5px 0;}
			.isYezhu{background-color: #eee;}
			.isYezhu .tishi{color: red;}
			.beizhu{margin-top: 30px;}
			.newAction, .newAction2 {width: 25%;height: calc((100vw - 26px) * 0.25);}
			#uppics2{padding: 0 14px;padding-right: 10px;}
			.cancelText{padding: 20px 15px 10px;}
			.cancelBtn{margin-top: 20px;}
			.evaluaCon textarea{height: 90px;}
			.copyBtn{float: right; border: none; padding: 0 !important; color: #c7161e;}
			.dingdanPingjia{margin-top: -8px; padding: 2px 6px; border-color: #ccc; color: #c7161e;}
			#huiC{display:inline-block!important;text-align:justify!important;width:20%;}
			.tihuoma{height: 46px;line-height: 48px;padding: 0 15px;font-size: 18px;font-weight: bold;color: #fff;
			    background: #ff4b1f;  /* fallback for old browsers */
                background: -webkit-linear-gradient(to right, #1fddff, #ff4b1f);  /* Chrome 10-25, Safari 5.1-6 */
                background: linear-gradient(to right, #1fddff, #ff4b1f); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
			}
			/*运费弹窗*/
			.yunfeiDetail{padding: 0px; font-size: 14px; margin-right: 10px;}
			.yunfeiDetail a{display: inline-block;color: #B62D29;padding: 3px 9px 0px;}
			.mui-popover .mui-table-view{overflow: scroll !important;}
			.mui-popover{height: 230px;}
			/*收起菜单*/
			.mui-card{margin: 10px 0 !important;box-shadow: 0 0px 1px rgba(0,0,0,.3) !important;}
			.mui-navigate-right:after, .mui-push-right:after{font-size: 26px;}
			.mui-table-view-cell>a:not(.mui-btn){font-size: 15px;}
			.newZhankai li, .mui-table-view-cell>a:not(.mui-btn).mui-active{background-color: #fff !important;}
			.newZhankai .mui-collapse-content{padding-right: 0 !important;}
			.Dpart3{margin-bottom: 0;padding-bottom: 0;}
			.mui-navigate-right:after, .mui-push-right:after{display: none;}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav fineB" style="padding-right: 15px;">
			<a id="leftbtn" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">订单详情</h1>
		</header>
		<script src="../../js/statusBar.js"></script>
		<div id="middlePopover" class="mui-popover">
			<div class="mui-popover-arrow"></div>
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul class="mui-table-view" id="yunfeiDataDiv"></ul>
					<script id="yunfeiDataS" type="text/html">
						<% for(var i=0; i<list.length; i++) {%>
							<li class="mui-table-view-cell">
								<span><%= list[i].changeType%>  </span>
								<span class="floL"><%= list[i].changeAmount%> 元 </span>
							</li>
						<% } %>
					</script>
				</div>
			</div>
		</div>
		<div id="main">
			<!--列表loading-->
			<div id="loadingdiv" style="text-align: center;font-size: 14px;height:32px;margin-bottom: 10px;
				line-height: 30px;color: #666;-webkit-transition: all .3s;overflow: hidden;">
				<img style="width: 30px;margin-top:5px;" src="../../img/Rolling.svg"/>
			</div>
		</div>
		<script type="text/html" id="mainS">
			<%if(detail.pickUpCode){%>
				<div class="tihuoma">
					订单提货码 ：<span style="float: right;font-size: 22px;"><%= detail.pickUpCode%></span>
				</div>
			<%}%>
			<div class="Dpart1">
				<h4 style="font-size: 15px !important;line-height: 1.6;">
					订单编号：<a id="copyDiv" style="color: #555;"><%= detail.orderNumber%></a>
					<button id="copyBtn" style="float: right;" class="span1 copyBtn">复制</button>
				</h4>
				<p>
					下单时间：<%= detail.createTime%>
					<span class="span2" style="color: #EE9000;"><%= detail.statusDesc%></span>
				</p>
			</div>
			<!--<div class="Dpart1 Dpart2" style="margin-bottom: 0;">
				<span class="huiC">支付方式</span> <span class="mui-pull-right"><%= detail.payType%></span>
			</div>-->
			<%if(detail.identityT == '0'){%>
				<div class="Dpart1 Dpart2">
					<span class="huiC">导购填写代收款</span> <span class="mui-pull-right"><%= detail.BillingDetailResponse.collectionAmount || '0'%> 元</span>
				</div>
			<%}%>
			<div class="Dpart3">
				<% if(detail.zhuangshi){ %>
					<!--<div>
						<span class="huiC">客户</span><span class="mui-pull-right"><%= detail.storeName  || '暂无'%></span>
					</div>-->
					<div>
						<span class="huiC">客户</span><span class="mui-pull-right"><%= detail.customerName  || '暂无'%></span>
					</div>
					<div>
						<span class="huiC">电话</span><span class="mui-pull-right"><%= detail.customerPhone || '暂无'%> </span>
					</div>
				<% } %>
				<div>
					<span class="huiC">收货人</span><span class="mui-pull-right"><%= detail.receiver%> <img style="width: 16px;position: relative;top: -1px;" src="../../images/center/tel.svg" alt="" /><a href="tel:<%=detail.receiverPhone%>"><%= detail.receiverPhone || '无'%></a></span>
				</div>
				<!--<%if(detail.isOwnerReceiving){%>
					<div>
						<span class="huiC">是否主家收货</span><span class="mui-pull-right">是</span>
					</div>
				<%}else{%>
					<div>
						<span class="huiC">是否主家收货</span><span class="mui-pull-right">否</span>
					</div>
				<%}%>-->
				<!--<div>
					<span class="huiC">提货码</span>
					<span class="mui-pull-right"> <%= detail.pickUpCode || '无'%> </span>
				</div>-->
				<div>
					<span class="huiC">配送方式</span> <span class="mui-pull-right"><%= detail.deliveryType || '无'%></span>
				</div>
				<div style="overflow: hidden;">
					<span class="huiC">配送地址</span> <span class="mui-pull-right" style="text-align: right;max-width: 75%;word-break: break-all;white-space: normal;"><%= detail.shippingAddress || '无'%></span>
				</div>
				<div>
					<span class="huiC">配送时间</span> <span class="mui-pull-right"><%= detail.deliveryTime || '无'%></span>
				</div>
				<div style="overflow: hidden;">
					<span class="huiC">订单备注</span> <span class="mui-pull-right" style="display: inline-block;max-width: 80%;text-align: right;"><%= detail.remark || '无'%></span>
				</div>
				<div style="overflow: hidden;">
					<span class="huiC">楼盘信息</span> <span class="mui-pull-right" style="display: inline-block;max-width: 80%;text-align: right;"><%= detail.estateInfo || '无'%></span>
				</div>
			</div>
			<%if(detail.customer && detail.customer.customerId){%>
				<div class="Dpart3">
					<div>
						<span class="huiC">顾客</span> <span class="mui-pull-right"><%= detail.customer.customerName || '无'%></span>
					</div>
					<div>
						<span class="huiC">顾客电话</span> <span class="mui-pull-right"><img style="width: 16px;position: relative;top: -1px;" src="../../images/center/tel.svg" alt="" /><a href="tel:<%=detail.customer.customerPhone%>"><%= detail.customer.customerPhone || '无'%></a></span>
					</div>
				</div>
			<%}%>
			<!-- ******************金额详情*************************-->

			<!--新的改造 做成展开模式-->
			<div class="mui-card">
				<ul class="mui-table-view newZhankai">
					<li class="mui-table-view-cell  mui-active" >
						<a class="mui-navigate-right">订单详情</a>
						<div class="mui-collapse-content Dpart4 Dpart3">
							<div>
								<span class="huiC">商品总额</span> <span class="floL"><%= detail.BillingDetailResponse.totalPrice%>元</span>
							</div>
							<div>
								<span class="huiC">运费</span>  <span class="floL"><%= detail.BillingDetailResponse.freight%>元</span> <button type="button" class="mui-btn mui-btn-danger mui-btn-outlined floL yunfeiDetail aClick"><a href="#middlePopover">明细</a></button>
							</div>
							<div>
								<span class="huiC">冲账户余额</span> <span class="floL">
									<%if(detail.BillingDetailResponse.memberDiscount>0){%>
										-<%= detail.BillingDetailResponse.memberDiscount%>元
									<%}else{%>
										<%= detail.BillingDetailResponse.memberDiscount%>元
									<%}%>
								</span>
							</div>
							<div>
								<span class="huiC">促销抵扣</span> <span class="floL">
									<%if(detail.BillingDetailResponse.promotionDiscount>0){%>
										-<%= detail.BillingDetailResponse.promotionDiscount%>元
									<%}else{%>
										<%= detail.BillingDetailResponse.promotionDiscount%>元
									<%}%>
								</span>
							</div>
							<%if(detail.identityT != '2'){%> <!--不是项目经理-->
							<div>
								<span class="huiC">产品券抵扣</span> <span class="floL">
									<%if(detail.BillingDetailResponse.productCouponDiscount>0){%>
										-<%= detail.BillingDetailResponse.productCouponDiscount || 0%>元
									<%}else{%>
										<%= detail.BillingDetailResponse.productCouponDiscount || 0%>元
									<%}%>
								</span>
							</div>
							<%}%>
							<div>
								<span class="huiC">优惠券抵扣</span> <span class="floL">
									<%if(detail.BillingDetailResponse.couponDiscount>0){%>
										-<%= detail.BillingDetailResponse.couponDiscount%>元
									<%}else{%>
										<%= detail.BillingDetailResponse.couponDiscount%>元
									<%}%>
								</span>
							</div>
							<!--客户经理查看订单详情，增加现金返利折扣金额显示-->
							<%if(detail.identityT == '2'){%> <!--装饰公司(项目经理) 单独-->
								<div>
									<span class="huiC">现金返利折扣</span> <span class="floL">
										<%if(detail.BillingDetailResponse.subvention>0){%>
											-<%= detail.BillingDetailResponse.subvention%>元
										<%}else{%>
											<%= detail.BillingDetailResponse.subvention%>元
										<%}%>
									</span>
								</div>
							<%}%>
							<div style="color: #4e4e4e !important;font-size: 16px;">
								<span>订单总价</span> <span class="floL">
									<%= detail.BillingDetailResponse.orderAmountSubtotal%>元
								</span>
							</div>
						</div>
					</li>
				</ul>
			</div>
			<% if(detail.BillingDetailResponse.upstairsFee != '0'){%>
				<div class="mui-card">
					<ul class="mui-table-view newZhankai">
						<li class="mui-table-view-cell">
							<a class="mui-navigate-right" >其他费用</a>
							<div class="mui-collapse-content Dpart4 Dpart3">
								<div>
									<span class="huiC">上楼费</span> <span class="floL"><%= detail.BillingDetailResponse.upstairsFee%>元</span>
								</div>
							</div>
						</li>
					</ul>
				</div>
			<%}%>
			<% if( (detail.identityT == '2' && detail.BillingDetailResponse.empCreditMoney != '0') || ( detail.identityT != '2' && detail.BillingDetailResponse.creditMoney != '0') ){%>
				<div class="mui-card">
					<ul class="mui-table-view newZhankai">
						<li class="mui-table-view-cell">
							<a class="mui-navigate-right" >额度详情</a>
							<div class="mui-collapse-content Dpart4 Dpart3">
								<%if(detail.identityT != '6'){%>
									<div>
										<span class="huiC">
											<%if(detail.identityT == '2'){%>
												信用金抵扣
											<%}else{%>
												信用额度抵扣
											<%}%>
										</span>
										<span class="floL">
											<!--装饰公司的这一个字段由creditMoney变为empCreditMoney-->
											<%if(detail.identityT == '2'){%>
												<%if(detail.BillingDetailResponse.empCreditMoney>0){%>
													-<%= detail.BillingDetailResponse.empCreditMoney || 0%>元
												<%}else{%>
													<%= detail.BillingDetailResponse.empCreditMoney || 0%>元
												<%}%>
											<%}else{%>
												<%if(detail.BillingDetailResponse.creditMoney>0){%>
													-<%= detail.BillingDetailResponse.creditMoney || 0%>元
												<%}else{%>
													<%= detail.BillingDetailResponse.creditMoney || 0%>元
												<%}%>
											<%}%>

										</span>
									</div>
								<%}%>
								<div style="color: #4e4e4e !important;font-size: 16px;">
									<span>额度使用合计</span> <span class="floL">
										<%= detail.BillingDetailResponse.totalCreditMoney%>元
									</span>
								</div>
							</div>
						</li>
					</ul>
				</div>
			<% } %>
			<div class="mui-card">
				<ul class="mui-table-view newZhankai">
					<li class="mui-table-view-cell ">
						<a class="mui-navigate-right" >付款详情</a>
						<div class="mui-collapse-content Dpart4 Dpart3">
							<%if(detail.BillingDetailResponse.preDeposit != '0'){%>
								<div>
									<span class="huiC">预存款抵扣</span> <span class="floL">
										<%if(detail.BillingDetailResponse.preDeposit>0){%>
											-<%= detail.BillingDetailResponse.preDeposit%>元
										<%}else{%>
											<%= detail.BillingDetailResponse.preDeposit%>元
										<%}%>
									</span>
								</div>
							<%}%>
							<!--顾客 装饰公司 (posMoney, cashMoney)-->
							<%if(detail.identityT == '6' || detail.identityT == '2'){%>
								<%if(detail.BillingDetailResponse.posMoney != '0'){%>
									<div><span class="huiC">POS支付</span> <span class="floL"><%= detail.BillingDetailResponse.posMoney%>元</span></div>
								<%}%>
								<%if(detail.BillingDetailResponse.cashMoney != '0'){%>
									<div><span class="huiC">现金支付</span> <span class="floL"><%= detail.BillingDetailResponse.cashMoney%>元</span></div>
								<%}%>
							<%}%>
							<!--导购(storeCash, storePosMoney, deliveryCash, deliveryPos)-->
							<%if(detail.identityT == '0'){%>
								<%if(detail.BillingDetailResponse.storeCash != '0'){%>
									<div><span class="huiC">门店现金</span> <span class="floL"><%= detail.BillingDetailResponse.storeCash%>元</span></div>
								<%}%>
								<%if(detail.BillingDetailResponse.storePosMoney != '0'){%>
									<div><span class="huiC">门店POS</span> <span class="floL"><%= detail.BillingDetailResponse.storePosMoney%>元</span></div>
								<%}%>
								<%if(detail.BillingDetailResponse.deliveryCash != '0'){%>
									<div><span class="huiC">配送现金</span> <span class="floL"><%= detail.BillingDetailResponse.deliveryCash%>元</span></div>
								<%}%>
								<%if(detail.BillingDetailResponse.deliveryPos != '0'){%>
									<div><span class="huiC">配送POS</span> <span class="floL"><%= detail.BillingDetailResponse.deliveryPos%>元</span></div>
								<%}%>
							<%}%>
							<div style="color: #4e4e4e !important;font-size: 16px;">
								<span>实付款合计</span> <span class="floL">
									<%= detail.BillingDetailResponse.amountPayable%>元
								</span>
							</div>
						</div>
					</li>
				</ul>
			</div>
			<!--新的改造 结束-->

			<div class="Dpart4 Dpart3">
				<!--乐币抵扣 弃用@@@@@@@@@@@@@@@@@-->
				<!--弃用@@@@@@<%if(detail.identityT == '6'){%>
					<div>
						<span class="huiC">乐币抵扣</span> <span class="floL">
							<%if(detail.BillingDetailResponse.leBiCashDiscount>0){%>
								-<%= detail.BillingDetailResponse.leBiCashDiscount%>元
							<%}else{%>
								<%= detail.BillingDetailResponse.leBiCashDiscount%>元
							<%}%>
						</span>
					</div>
				<%}%>弃用@@@@@@-->
				<!--代付金额 弃用@@@@@@@@@@@@@@@@@ -->
				<!--弃用@@@@@@<% if(detail.zhuangshi == 'yi'){ %>
					<div>
						<span class="huiC">代付金额</span> <span class="floL"><%= detail.BillingDetailResponse.payForAnotherMoney%>元</span>
					</div>
					<div>
						<span class="huiC">代付方式</span> <span class="floL"><%= detail.BillingDetailResponse.payType%></span>
					</div>
				<% } %>弃用@@@@@@-->
				<!--代付金额   弃用@@@@@@@@@@@@@@@@@-->
				<!--项目经理-->
				<!--弃用@@@@@@<% if(detail.identityT == '2' && detail.BillingDetailResponse.payForAnotherMoney){ %>
					<div>
						<span class="huiC">代付金额</span> <span class="floL"><%= detail.BillingDetailResponse.payForAnotherMoney%>元</span>
					</div>
				<% } %> 弃用@@@@@@-->
				<!--代付金额   弃用@@@@@@@@@@@@@@@@@-->
				<!--顾客-->
				<!--弃用@@@@@@<%if(detail.identityT == '6'){%>
					<%if(detail.customerBillingDetailResponse && detail.customerBillingDetailResponse.payForAnotherMoney){%>
						<div>
							<span class="huiC">代付金额</span> <span class="floL">
								<%= detail.customerBillingDetailResponse.payForAnotherMoney || 0%>元
							</span>
						</div>
					<%}%>
				<%}%>弃用@@@@@@-->
			</div>



			<!--***********************金额详情结束***********************-->



			<!--订单评价-->
			<div class="Dpart3" id="evaluat" style="display: none;">
				<h4 class="fineB dingdanPJ">订单服务评价</h4>
				<div class="mui-content-padded">
					<div class="vm">
						<span>产品：</span><!--mui-icon-star-filled-->
						<div class="icons mui-inline" style="margin-left: 6px;vertical-align: middle;display: inline;">
							<% for(var i=1;i<detail.productStar+1;i++){%>
								<i data-index="<%= i%>" class="mui-icon mui-icon-star-filled"></i>
							<% }%>
							<% for(var j=detail.productStar+1;j<6;j++){%>
								<i data-index="<%= j%>" class="mui-icon mui-icon-star"></i>
							<% }%>
						</div>
					</div>
				</div>
				<div class="mui-content-padded">
					<div class="vm">
						<span>物流：</span><!--mui-icon-star-filled-->
						<div class="icons mui-inline" style="margin-left: 6px;vertical-align: middle;display: inline;">
							<% for(var i=1;i<detail.logisticsStar+1;i++){%>
								<i data-index="<%= i%>" class="mui-icon mui-icon-star-filled"></i>
							<% }%>
							<% for(var j=detail.logisticsStar+1;j<6;j++){%>
								<i data-index="<%= j%>" class="mui-icon mui-icon-star"></i>
							<% }%>
						</div>
					</div>
				</div>
				<div class="mui-content-padded">
					<div class="vm">
						<span>服务：</span><!--mui-icon-star-filled-->
						<div class="icons mui-inline" style="margin-left: 6px;vertical-align: middle;display: inline;">
							<% for(var i=1;i<detail.serviceStars+1;i++){%>
								<i data-index="<%= i%>" class="mui-icon mui-icon-star-filled"></i>
							<% }%>
							<% for(var j=detail.serviceStars+1;j<6;j++){%>
								<i data-index="<%= j%>" class="mui-icon mui-icon-star"></i>
							<% }%>
						</div>
					</div>
				</div>
			</div>
			<div class="proWrapAll" style="margin-bottom: 55px;">
				<%for(var i=0;i<detail.goodsList.length;i++){ %>
					<div class="proWrap fineB">
						<div class="proLeft">
							<img src="<%= detail.goodsList[i].coverImageUri || '../../img/editset.png'%>"/>
						</div>
						<div class="proRight">
							<h4><%= detail.goodsList[i].skuName%></h4>
							<p>
								规格：<%= detail.goodsList[i].goodsSpecification%>  单位：<%= detail.goodsList[i].goodsUnit%>
								<% if(detail.statusDesc == '已完成' || detail.statusDesc == '已结案'){%>
									<% if(!detail.goodsList[i].isEvaluation){%>
										<button type="button" class="mui-btn" onclick="evaluaProduct('<%= detail.goodsList[i].goodsId%>',this)">评价</button>
									<% }else{%>
										<button type="button" class="mui-btn">已评价</button>
									<% }%>
								<% }%>
							</p>
							<div>
								<span class="span1">
									<%if(detail.goodsList[i].goodsType == 'PRESENT'){%>
										<em class="mui-badge mui-badge-danger" style="color: white;position: relative;top: -2px;">赠品</em>
									<%}else if(detail.goodsList[i].goodsType == 'PRODUCT_COUPON'){%>
										<em class="mui-badge mui-badge-warning" style="color: white;position: relative;top: -2px;">产品券</em>
									<%}%>
									¥<%= detail.goodsList[i].retailPrice%>
								</span>
								<span class="span2">
									x<%= detail.goodsList[i].qty%>
								</span>
							</div>

						</div>
					</div>
				<%} %>
			</div>

			<div class="footBtn">
				<% if(!detail.zhuangshi){ %>
					<!--待付款：UNPAID，待发货：PENDING_SHIPMENT，待收货：PENDING_RECEIVE，已取消：CANCELED，取消中：CANCELING，已完成：FINISHED，拒签：REJECTED，已结案：CLOSED。-->
					<% if(detail.deliveryType == '送货上门' || detail.deliveryType == '门店自提'){%>
	                    <% if(detail.status == 'UNPAID'){%>
	                        <!--<span class="redC aClick" onclick="goToPay('<%= detail.orderNumber%>','<%= detail.price%>')">去支付</span>-->
	                    <% }%>
	                    <% if(detail.status == 'UNPAID' || detail.status == 'PENDING_SHIPMENT'){%>
	                        <span class="aClick" onclick="cancelFun('<%= detail.orderNumber%>',this)">取消订单</span>
	                    <% }%>
	                    <% if(detail.deliveryType == '门店自提' && detail.status == 'PENDING_RECEIVE'){%>
	                        <span class="aClick" onclick="cancelFun('<%= detail.orderNumber%>',this)">取消订单</span>
	                    <% }%>
	                    <% if(detail.status == 'FINISHED'){%>
	                        <span class="redC aClick" onclick="openReturns('<%= detail.orderNumber%>','<%= detail.customer.customerId%>','<%=detail.deliveryType%>')">退货</span>
	                    <% }%>
	                    <span onclick="comeOnAgain('<%= detail.orderNumber%>','<%= detail.customer.customerId%>')" class="aClick">再来一单</span>
	                <% }%>

	                <% if(detail.deliveryType == '送货上门'){%>
	                    <% if(detail.status != 'UNPAID' && detail.status != 'CANCELED' && detail.status != 'CANCELING'){%>
	                        <span onclick="goOrderWL('<%= detail.orderNumber%>')" class="aClick redC lookwl">查看物流</span>
	                    <% }%>
	                <% }%>

	                <%if(detail.deliveryType.indexOf('产品券')>-1){%>
						<%if(detail.status == "FINISHED"){%>
							<span class="redC aClick" onclick="openReturns('<%= detail.orderNumber%>','<%= detail.customer.customerId%>','<%= detail.deliveryType%>')">退货</span>
						<%}%>
					<%}%>
				<%}else{%>
					<!--导购的 客户待付款清-->
					<% if(detail.status == 'UNPAID'){%>
						<span class="redC aClick" onclick="goToPay('<%= detail.orderNumber%>','<%= detail.BillingDetailResponse.amountPayable%>','<%=detail.creditMoney%>','<%=detail.stPreDeposit%>')">去支付</span>
					<% }else{%>
						<span onclick="goOrderWL('<%= detail.orderNumber%>')" class="aClick redC lookwl">查看物流</span>
					<% } %>
				<%}%>
			</div>

		</script>

		<!--评价商品-->
		<div class="cancelDiv" id="evaluaSP" style="display: none;">
			<div class="cancelCon">
				<div class="cancelMin">
					<div class="cancelText evaluaCon">
						<textarea class="evaluaText" placeholder="请您输入评价！（最大可输入字数120字）" maxlength="255"></textarea>
					</div>
					<div class="uppics clearfix" id="uppics2">
				        <div class="onepic newActionWrap">
				        		<a class="newAction2"><img id="nowpic" style="width: 89%;height: 89%;margin-left: 11%;" onclick="showAction()" src="../../img/addpic.png"></a>
				        </div>
				    </div>
					<div class="cancelBtn">
						<button type="button" class="mui-btn operating1">取消</button>
						<button type="button" id="evaluaOk" class="mui-btn mui-btn-danger operating2">确定</button>
					</div>
				</div>
			</div>
		</div>
		<!--取消订单-->
		<div class="cancelDiv" id="cancelOrder" style="display: none;">
			<div class="cancelCon">
				<div class="cancelMin">
					<h4 class="fineB h4">取消原因</h4>
					<div id="cancelDiv0"></div>
					<script type="text/html" id="cancelDiv0S">
						<% for(var i=0;i<list.length;i++){%>
							<div class="mui-input-row mui-radio mui-left">
								<label><%= list[i].reason%></label>
								<input class="reasonInfo" value="<%= list[i].reason%>" name="radio1" type="radio">
							</div>
						<% }%>
					</script>
					<div class="cancelText">
						<textarea id="remarksInfo" placeholder="请输入备注内容" name="" cols=""></textarea>
					</div>
					<div style="height: 50px;"></div>
					<div class="cancelBtn">
						<button type="button" class="mui-btn operating1">取消</button>
						<button type="button" class="mui-btn mui-btn-danger operating3">确定</button>
					</div>
				</div>
			</div>
		</div>
		<!-- 去支付操作表-->
		<div id="maskInfo" style="display: none;">
			<!-- 可选择菜单 -->
			<ul class="paychoose ft14">
				<li class="fttc pad10 afterBorder ft16 activecl">
					应付金额：<span id="payMoney">---</span>
				</li>
				<li class="pad10 afterBorder aClick2" id="alipay">
					<img src="../../images/order/alipay.svg" />支付宝
				</li>
				<li class="pad10 afterBorder aClick2" id="wxpay">
					<img src="../../images/order/weixinpay.svg" />微信
				</li>
				<li class="pad10 afterBorder aClick2" id="UnionPayY">
					<img src="../../images/order/bankpay.svg" />银联支付
				</li>
				<li class="pad10 afterBorder aClick2" id="eduzhifu" style="display: none;">
					<img src="../../images/order/eduzhifu.svg" />信用额度 <span class="ft12">余额 <span id="creditVal"></span></span>
				</li>
				<li class="pad10 afterBorder aClick2" id="yucunzhifu" style="display: none;">
					<img src="../../images/order/yucunzhifu.svg" />门店预存款 <span class="ft12">余额 <span id="mdyckm"></span></span>
				</li>
				<li class="closeMask fttc pad10" style="padding: 14px;">
					待付款
				</li>
			</ul>
		</div>

		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/default.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/feedback.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/clipboard.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">

			//去支付
			var pays = {};
			$('#maskInfo li').click(function() {
				event.stopPropagation();
			})
			$('.closeMask').click(function() {
				event.preventDefault();
				$('#maskInfo').fadeOut(200);
			})
			function goToPay(orderNo,money,creditmoney,stPreDeposit){
				mui.plusReady(function(){
					var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
					var userId = plus.storage.getItem('$userId');
					var oldToken = plus.storage.getItem('oldToken');
					console.log(oldToken)
					mui.ajax(serverUrl+'/app/order/verify/timeout',{
						data: {
							userId: userId,
							identityType: identityT,
							orderNumber:orderNo
						},
						dataType: 'json',
						type: 'post',
						timeout: 20000,
						headers: {
							"Authorization": oldToken,
						},
						success:function(data,type,xhr){
							plus.nativeUI.closeWaiting();
							console.log('过期否',data);
							if(data.code == 0 ){
								if(money>0){
									$('#payMoney').html('¥' + money);
									$('#maskInfo').fadeIn(200);
									if(creditmoney) {
											$('#creditVal').html('¥' + creditmoney)
										} else {
											$('#creditVal').html('¥' + 0)
										}
										if(stPreDeposit) {
											$('#mdyckm').html('¥' + stPreDeposit)
										} else {
											$('#mdyckm').html('¥' + 0)
										}

									toPay(money, orderNo)
								}else{
									dontPay (orderNo)
								}
							}else{
								mui.toast(data.message)
								plus.webview.currentWebview().reload();
							}
						},
						error:function(xhr,type,errorThrown){
							plus.nativeUI.closeWaiting();
							mui.toast(type)
							console.log('响应失败');
						}
					});
					function dontPay (orderNumber) {
						mui.ajax(serverUrl+'/app/order/pay/zero/order',{
							data: {
								userId: userId,
								identityType: identityT,
								orderNumber:orderNumber
							},
							dataType: 'json',
							type: 'post',
							timeout: 20000,
							headers: {
								"Authorization": oldToken,
							},
							success:function(data,type,xhr){
								plus.nativeUI.closeWaiting();
								console.log('无需付款',data);
								if(data.code == 0 ){
									mui.alert('支付成功')
									plus.webview.currentWebview().reload();
								}else{
									mui.toast(data.message)
								}
							},
							error:function(xhr,type,errorThrown){
								plus.nativeUI.closeWaiting();
								mui.toast(type)
								console.log('响应失败');
							}
						});
					}
				})
			}
			//系统检测获取支付通道
			function toPay(payableAmount, orderNumber) {
				document.getElementById('yucunzhifu').setAttribute('onclick', 'payfun("yucunzhifu","' + payableAmount + '","' + orderNumber + '")');
				document.getElementById('eduzhifu').setAttribute('onclick', 'payfun("eduzhifu","' + payableAmount + '","' + orderNumber + '")');
				document.getElementById('UnionPayY').setAttribute('onclick', 'payfun("UnionPayY","' + payableAmount + '","' + orderNumber + '")');
				plus.payment.getChannels(function(channels) {
					console.log("channel " + JSON.stringify(channels));
					for(var i in channels) {
						var channel = channels[i];
						// 过滤掉不支持的支付通道：暂不支持360相关支付
						if(channel.id == 'qhpay' || channel.id == 'qihoo') {
							continue;
						}
						pays[channel.id] = channel;
						if(channel.id == 'alipay') { //添加支付事件
							document.getElementById('alipay').setAttribute('onclick', 'payfun("alipay","' + payableAmount + '","' + orderNumber + '")');
						}
						if(channel.id == 'wxpay') {
							document.getElementById('wxpay').setAttribute('onclick', 'payfun("wxpay","' + payableAmount + '","' + orderNumber + '")');
						}
						checkServices(channel);
					}
				}, function(e) {
					plus.nativeUI.alert("支付失败，请重试", null, "提示");
				});

				// 检测是否安装支付服务
				function checkServices(pc) {
					if(!pc.serviceReady) {
						var txt = null;
						switch(pc.id) {
							case "alipay":
								txt = "检测到系统未安装“支付宝快捷支付服务”，无法完成支付操作，是否立即安装？";
								break;
							default:
								txt = "系统未安装“" + pc.description + "”服务，无法完成支付，是否立即安装？";
								break;
						}

					}
				}
				//系统检测获取支付通道结束
			}
			mui.plusReady(function(){
				mui('.mui-scroll-wrapper').scroll();
				//获取缓存
				var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
				var userId = plus.storage.getItem('$userId');
				var oldToken = plus.storage.getItem('oldToken');
				// 支付接口
				window.payfun = function(id, payableAmount, orderNumber) {
					var varpay;
					if(id == 'alipay' || id == 'wxpay') {
						//调用支付功能
						plus.nativeUI.showWaiting();
						gopay(id, payableAmount, orderNumber);
					} else if(id == 'yucunzhifu' || id == 'eduzhifu'){
						zhuangshiPay(id, payableAmount, orderNumber);
					}else if(id == 'UnionPayY'){
						UnionPayYGoPay(id, payableAmount, orderNumber);
					}else {
						plus.nativeUI.alert("当前环境不支持此支付通道！", null, "提示");
						return;
					}
					//银联的支付
					function UnionPayYGoPay(id, payableAmount, orderNumber){
						plus.nativeUI.showWaiting();
						mui.ajax(serverUrl + '/app/unionpay/order/pay/html', {
							data: {
								userId: userId,
								identityType: identityT.toString(),
								payableAmount: payableAmount,
								orderNumber: orderNumber
							},
							type: 'post', //HTTP请求类型
							headers: {
								"Authorization": oldToken
							},
							timeout: 20000, //超时时间设置为10秒；
							success: function(data) {
								if(data.message){
									plus.nativeUI.closeWaiting();
									mui.alert(data.message || '支付失败,请重试！')
								}else{
									plus.nativeUI.closeWaiting();
									openview({
										view:'UnionPayYGoPay.html',
										id:'UnionPayYGoPay',
										extrasobj:{
											dataHtml:data,
											orderNumber: orderNumber,
											payableAmount: payableAmount
										}
									})
								}
							},
							error: function(xhr, type, errorThrown) {
								//异常处理；
								plus.nativeUI.closeWaiting();
								plus.nativeUI.alert("支付失败,请重试！");
							}
						});

					}
					//客户支付方法
					function zhuangshiPay(id, payableAmount, orderNumber){
						plus.nativeUI.showWaiting()
						var payType = 'EMP_CREDIT'
						if(id == 'yucunzhifu'){payType = 'ST_PREPAY'}
						mui.ajax(serverUrl + '/app/order/handle/payForAnother', {
							data: {
								userId: userId,
								identityType: identityT.toString(),
								orderNumber: orderNumber,
								payType: payType
							},
							type: 'post', //HTTP请求类型
							headers: {
								"Authorization": oldToken
							},
							timeout: 20000, //超时时间设置为10秒；
							success: function(data) {
								console.error(data);
								plus.nativeUI.closeWaiting();
								if(data.code == 0) {
									mui.alert('支付成功')
									mui.fire(plus.webview.getWebviewById('center.html'),'refresh');
									openview({
										view:'myOrderList.html',
										id: 'myOrderList',
										reOpen:true,
										extrasobj:{
											type:'yi'
										}
									})
									setTimeout(function(){
										plus.webview.currentWebview().close();
									},2000)
								}else{
									mui.alert(data.message || '支付失败,请重试！')
								}
								plus.nativeUI.closeWaiting()
							},
							error: function(xhr, type, errorThrown) {
								//异常处理；
								plus.nativeUI.closeWaiting();
								plus.nativeUI.alert("支付失败,请重试！");
							}
						});
					}
					//微信支付宝 支付 方法
					function gopay(id, payableAmount, orderNumber) {
						if(id == 'wxpay') {
							//微信
							mui.ajax(serverUrl + '/app/wechatpay/order/pay', {
								data: {
									userId: userId,
									identityType: identityT.toString(),
									amountPayable: payableAmount,
									orderNumber: orderNumber,
								},
								type: 'post', //HTTP请求类型
								headers: {
									"Authorization": oldToken
								},
								timeout: 10000, //超时时间设置为10秒；
								success: function(data) {
									console.error(data);
									plus.nativeUI.closeWaiting();
									if(data.code == 0) {
										varpay = {
											"appid": data.content.appid,
											"noncestr": data.content.noncestr,
											"package": "Sign=WXPay",
											"partnerid": data.content.partnerid,
											"prepayid": data.content.prepayid,
											"timestamp": parseInt(data.content.timestamp),
											"sign": data.content.sign
										};
										//微信
										plus.payment.request(pays[id], varpay, function(result) {
											console.log("----- 支付成功 -----");
											var result = JSON.stringify(result);
											mui.fire(plus.webview.getWebviewById('center.html'),'refresh');
											openview({
												view:'myOrderList.html',
												id: 'myOrderList',
												extrasobj:{
													type:'yi'
												}
											})
											setTimeout(function(){
												plus.webview.currentWebview().close();
											},2000)
										}, function(e) {
											console.log("----- 支付失败 -----");
											console.log("[" + e.code + "]：" + e.message);
											plus.nativeUI.alert("支付失败");
										});
									}

								},
								error: function(xhr, type, errorThrown) {
									//异常处理；
									console.log(type);
									console.log("----- 请求订单失败 -----");
									console.log(xhr.status);
									plus.nativeUI.closeWaiting();
									plus.nativeUI.alert("获取订单信息失败！");
								}
							});
						} else {
							//支付宝
							mui.ajax(serverUrl + '/app/alipay/order/pay', {
								data: {
									userId: userId,
									identityType: identityT.toString(),
									payableAmount: payableAmount,
									orderNumber: orderNumber,
								},
								type: 'post', //HTTP请求类型
								headers: {
									"Authorization": oldToken
								},
								timeout: 10000, //超时时间设置为10秒；
								success: function(data) {
									console.error(data);
									plus.nativeUI.closeWaiting();
									if(data.code == 0) {
										varpay = data.content;
										plus.payment.request(pays[id], varpay, function(result) {
											console.log("----- 支付成功 -----", JSON.stringify(result));
											plus.nativeUI.closeWaiting();
											plus.nativeUI.alert("支付成功");
											openview({
												view:'myOrderList.html',
												id: 'myOrderList',
												reOpen:true,
												extrasobj:{
													type:'yi'
												}
											})
											setTimeout(function(){
												plus.webview.currentWebview().close();
											},2000)

										}, function(e) {
											console.log("----- 支付失败 -----");
											console.log("[" + e.code + "]：" + e.message);
											plus.nativeUI.closeWaiting();
											plus.nativeUI.alert("支付失败");
										});
									}

								},
								error: function(xhr, type, errorThrown) {
									//异常处理；
									console.log(type);
									console.log("----- 请求订单失败 -----");
									console.log(xhr.status);
									plus.nativeUI.closeWaiting();
									plus.nativeUI.alert("获取订单信息失败！");
								}
							});

						}
					}

				}
			})
			//去支付结束

			mui.plusReady(function(){
				var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
				var userId = plus.webview.currentWebview().lookCusid || plus.storage.getItem('$userId');
				var oldToken = plus.storage.getItem('oldToken');
				var orderNo = plus.webview.currentWebview().orderNo;
				var evaluat = plus.webview.currentWebview().evaluat;
				var isButton = plus.webview.currentWebview().isButton;
				var noButton = plus.webview.currentWebview().noButton;
				var zhuangshi = plus.webview.currentWebview().zhuangshi;
				var cancelParentId = plus.webview.currentWebview().cancelParentId;
				if(plus.webview.getWebviewById("orderSuccess")) {
					plus.webview.getWebviewById("orderSuccess").close();
				}
				/*订单详情*/
				var apiStr = '/app/order/detail'
				var postData = {'userID':userId,'identityType':identityT,'orderNumber':orderNo}
				if(zhuangshi){
					apiStr = '/app/order/payForAnother/detail'
			     	postData = {'userId':userId,'identityType':identityT,'orderNumber':orderNo}
				}
				mui.ajax(serverUrl + apiStr,{
					data:postData,
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"Authorization":oldToken},
					success:function(data,type,xhr){
						console.log('订单详情',data);
						if(data.code == 0){
							if(!data.content.customer || !data.content.customer.customerId){
								data.content.customer = {customerId:null}
							}
							data.content.identityT = identityT;
							if(zhuangshi){
								data.content.zhuangshi = zhuangshi
							}
							data.content.BillingDetailResponse = data.content.customerBillingDetailResponse || data.content.managerBillingDetailResponse || data.content.sellerBillingDetailResponse;
							document.getElementById('main').innerHTML = template('mainS',{detail:data.content});
							if(data.content.freightChange){
								data.content.freightChanges.unshift({changeType:'初始运费',changeAmount: data.content.freightChange.freight})
							}
							document.getElementById('yunfeiDataDiv').innerHTML = template('yunfeiDataS',{list:data.content.freightChanges});
							if(zhuangshi){
								if(data.content.isUseStorePre){
									mui('#yucunzhifu')[0].style.display = 'block'
								}
								if(data.content.isUseEmpCredit){
									mui('#eduzhifu')[0].style.display = 'block'
								}
							}
							if(isButton == 'no'){
								$('.footBtn,.proRight button').hide();
							}
							if(noButton){
								$('.footBtn>span:not(.lookwl)').remove();
							}
							//显示订单评价
							if(data.content.logisticsStar || data.content.productStar || data.content.serviceStars){
								mui('#evaluat')[0].style.display = 'block';
							}
							//复制方法
							var orderNumber = data.content.orderNumber;
					        var clipboard = new Clipboard('.copyBtn', {
					        		text: function() {
						            return orderNumber;
						        }
						    });
						    clipboard.on('success', function(e) {
						    		mui.toast('复制成功');
						        console.log('成功'+e.text);
						    });
						    clipboard.on('error', function(e) {
						        console.log('失败',e);
						    });
						    //复制结束

						}else{
							mui.toast(data.message);
						}


					},
					error:function(xhr,type,errorThrown){
						console.log('响应失败  !');
					}
				});

				//订单操作
				//再来一单 ==> order0.js
				//申请退货 ==> order0.js
				//打开订单物流  ==> order0.js
				//评价订单 ==> !!（无需做）
				//支付 ==> ??

				//取消订单
				cancelOF('detail',cancelParentId);
			})

			/*商品评价*/
			$('.operating1').click(function(){//点取消
				$('#evaluaSP').css('display','none');
			})
			$('.cancelDiv').click(function(){//点遮罩
				$('#evaluaSP').css('display','none');
			})
			$('.cancelMin').click(function(){
				event.stopPropagation();
			})
			//选择图片组件
			var Apic = [],time1 = null,maxNum = 3;
			function getImage(){//拍照并保存
				var cmr = plus.camera.getCamera();
				cmr.captureImage( function ( path ) {
					plus.io.resolveLocalFileSystemURL(path,function(entry){
						path = plus.io.convertLocalFileSystemURL(path);
						if(0!=path.indexOf("file://")){path="file://"+path;}
				    		var nowpic = Math.random().toString(36).substr(2) + '.jpg';
				    		var endpic = path.split('.')[0]+"/"+nowpic;
						plus.zip.compressImage({//压缩方法
							src:path,
							dst:endpic,
							overwrite:true,
							quality:30
						},
						function(obj) {
							showImg(obj.target);
							Apic.push(obj.target);
						},function(error) {
							mui.toast('图片获取错误，请重试');
						});
					});
				}, function ( e ) {
					mui.alert('拍照失败 \n 请在设置中允许我们使用你的照相机！');
				}, {filename:"_doc/gallery/",index:1} );
			}
			function galleryImgsSelected(){//从相册中选择图片
				mui.plusReady(function(){
				    plus.gallery.pick( function(e){
					    	clearInterval(time1);
					    	var indexNum = 0;
					    	var indexMax = e.files.length - 1;
					    	time1 = setInterval(function(){
					    		if(0!=e.files[indexNum].indexOf("file://")){e.files[indexNum]="file://"+e.files[indexNum];}
					    		if(indexNum == indexMax){//全部压缩完毕
					    			clearInterval(time1),time1 = null;
					    		}
					    		var nowpic = Math.random().toString(36).substr(2) + '.jpg';//随机字符串
					    		var endpic = e.files[indexNum].split('.')[0]+"/" +nowpic;
				    			plus.zip.compressImage({
								src:e.files[indexNum],
								dst:endpic,
								overwrite:true,
								quality:30
							},
							function(obj) {
								Apic.push(obj.target);
								showImg(obj.target,indexNum);
							},function(error) {
								mui.toast('图片获取错误，请重试');
							});
					    		indexNum ++;
					    	},500)
				    }, function ( e ) {
				    		mui.alert('读取相册失败 \n 请在设置中允许我们读取你的相册！');
				    },{filter:"image",multiple:true,maximum:maxNum-Apic.length,system:false,onmaxed:function(){//保存选择记录
				    		mui.alert('最多选择'+maxNum+'张图片！');
				    }});
				})
			}
			function showImg(url,indexNum){//显示图片
				if(0!=url.indexOf("file://")){url="file://"+url;}
				if($('.newAction').length){
					$('.newAction').eq($('.newAction').length-1).after('<a class="newAction"><img data-preview-src="" data-preview-group="1" src="'+url+'"/><span onclick="closePic(this)" class="mui-icon mui-icon-closeempty"></span></a>');
				}else{
					$('.onepic').prepend('<a class="newAction"><img data-preview-src="" data-preview-group="1" src="'+url+'"/><span onclick="closePic(this)" class="mui-icon mui-icon-closeempty"></span></a>');
				}
			}
			function closePic(obj){
				var nowPic = $(obj).parentsUntil('.newActionWrap').find('img').attr('src');
				console.log($(obj).parent().html())
				$(obj).parent().remove();
				if(Apic.indexOf(nowPic)>-1){
					Apic.splice($.inArray(nowPic,Apic),1);
				}
			}
			function showAction(){
				if(Apic.length  < maxNum){
					mui.plusReady(function(){
						plus.nativeUI.actionSheet({
							cancel: "取消",
							buttons: [{
								title: "相册选择"
							}, {
								title: '拍照'
							}]
						},
						function(e) {
							if (e.index == 1) { //点击从相册选择
								galleryImgsSelected();
							} else if (e.index == 2) {
								getImage();
							}
						})
					})
				}else{
					mui.alert('最多选择'+maxNum+'张图片！');
				}

			}
			//选择图片组件结束
			function evaluaProduct(goodId,that){
				$('#evaluaSP').css('display','table');
				mui.plusReady(function(){
					var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
					var userId = plus.storage.getItem('$userId');
					var oldToken = plus.storage.getItem('oldToken');
					var orderNo = plus.webview.currentWebview().orderNo;
					var cancelParentId = plus.webview.currentWebview().cancelParentId;

					//确认评价
					document.getElementById('evaluaOk').onclick = function(){
						var content = $('.evaluaText').val();
						if(!content){
							mui.toast("还未填写内容呢！");
			    	   			mui('.evaluaText')[0].focus();
//						}else if(!Apic.length){
						}else if(false){
					    		mui.toast("请添加图片");
					    	}else{
					    		plus.nativeUI.showWaiting();
							//发送数据开始
							var task = plus.uploader.createUpload(serverUrl+'/app/order/evaluation/goods/submit',
								{ method:"POST"},
								function(back,status){
									if(status == 200){
										console.log(back.responseText);
										var dataobj = JSON.parse(back.responseText);
										console.log('评价商品',JSON.stringify(dataobj));
										plus.nativeUI.closeWaiting(); //关闭等待框
										if(dataobj.code == 0){
											mui.toast("评价成功！");
											that.innerHTML = '已评价';
											that.onclick = null;
											$('#evaluaSP').css('display','none');
											$('.evaluaText').val('');
											Apic = [];
											$('.onepic').html('<a class="newAction2"><img id="nowpic" style="width: 89%;height: 89%;margin-left: 11%;" onclick="showAction()" src="../../img/addpic.png"></a>');
										}else{
											mui.toast(dataobj.message);
										}
									}else{
										plus.nativeUI.closeWaiting();
										mui.toast("当前网络不好，请重试！");
										console.log('响应失败  !');
									}
								}
							);

							task.setRequestHeader('Authorization',oldToken);
							task.addData('userId',userId);
							task.addData('identityType',identityT.toString());
					        task.addData('orderNumber',orderNo);
					        task.addData('goodsId',goodId.toString());
					        task.addData('evaluationContent',content);

							if(Apic.length){
								console.log(Apic);
								[].forEach.call(Apic,function(ele,index){
									//task.addFile(ele, {key:'pictures'});
									task.addFile(ele, {key:index.toString()});
									if(index == Apic.length-1){ task.start(); }
								})
							}else{
								task.start();
							}

					    	}
					}

				})
			}
			/*商品评价结束*/



		</script>
	</body>

</html>