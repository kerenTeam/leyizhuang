<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>配送员</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">
		<link rel="stylesheet" type="text/css" href="../../css/commonY.css">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" href="../../css/resetY.css">
		<link rel="stylesheet" type="text/css" href="../../css/configW.css"/>
		<script type="text/javascript" src="../../js/jquery.min.js"></script>
		<script src="../../js/mui.min.js" type="text/javascript"></script>
		<style type="text/css">
			body {
				margin: 0;
			}

			body::-webkit-scrollbar {
				/*滚动条*/
				width: 0!important;
				height: 0!important;
				opacity: 1!important;
			}
			.white {
				color: #FFFFFF !important;
				width: 100%;
			}
			.myInfo {
				width: 70px;
			    height: 70px;
			    margin: 4% 6%;
				border-radius: 50%;
				border: 2px solid rgba(255, 255, 255, 0.7);
			}

			.denlu {
				font-size: 15px;
			}
			
			/*修改*/
			.denlu {
				/*padding-left: 20px;*/
				color: #fff;
				line-height: 25px;
			}
			.writing {
				padding: 22px 0 5px;
				padding-bottom: 5px;
				margin-left: -25px;
			}
			#userBox {
				background-color: #eca4a6;
				padding: 35px 0 17px;
				position: relative;
			}
			.dao {
				color: white!important;
				border-color: white;
				padding: 1px 7px;
				top: 10px;
				right: 10px;
				position: absolute;
				font-size: 12px;
				border-radius: 2px;
			}
			.qiandao{
				font-size: 14px;
				border-radius: 2px;
				background: orange;
				padding:2px 10px;
				top: 45px;
				right: 10px;
				position: absolute;
			}
			.centop span {
				display: inline-block;
				padding: 4px 0;
				font-size: 14px;
			}

			#beijing {
				position: absolute;
				z-index: 10;
				width: 100%;
				height: 100%;
				top: 0;
				overflow: hidden;
				/*-webkit-filter: blur(5px);*/
			}

			#beijing img {
				width: 100%;
				position: relative;
				/*top: -40%;*/
			}

			#beijing2 {
				position: absolute;
				z-index: 20;
				width: 100%;
				height: 100%;
				top: 0;
				background-color: rgba(241, 63, 63, 0.76);
			}

			#userBox .content {
				position: relative;
				z-index: 30;
			}
			.notice li.active{border-bottom: 2px solid #B62D29;box-sizing: border-box;color: #B62D29;}
			.tab-hd{height: 45px !important;border-bottom: 1px solid #EFEFF4 !important;}
			.tab-nav li{height: 45px !important;}
			body{background-color: #f3f3f3;}
			.mui-bar-nav{box-shadow: none !important;}
			header.mui-bar{z-index: 200;}
			.notice .tab-hdtwo li {width: 25%;font-size: 16px!important;}
			.checkList{background-color: #fff;margin-top: 10px;}
			.checkList h4{padding: 12px 10px;}
			.checkList h4 .h4span3{float: right;color: #B62D29;}
			.checkList h4 .h4span2{margin-left: 3%;}
			.checkListCon{padding: 10px;line-height: 2;}
			.checkListDZ{padding: 10px 0;color: #757575;font-size: 16px;}
			.checkListB{padding: 10px 20px;text-align: right;}
			#infoListDiv{transition: all .3s;}
			.flexr{display: flex;justify-content: space-between;margin: 2px 0;}
			a,a:active{color: rgb(51,51,51)!important;}
			.flexRow2{display: flex;text-align: center;padding: 8px;}
			.flexRow2 div{width: 50%;}
			.flexRow2 img{width: 30px;vertical-align: middle;}
		</style>
	</head>
	<body>
		 
		<div class="clearfloat box-s box-ss" id="userBox">
			<div id="beijing"><img id="mypic1" src="../../images/center/centerBg.png"></div>
			<!--<div id="beijing2"></div>-->
			<div id="fixdtop"></div>
			<div class="content clearfloat fl mui-row white">
				<div class="mui-col-sm-4 mui-col-xs-4" style="padding-top: 18px;position: relative;left: 3px;"><img src="https://b-ssl.duitang.com/uploads/item/201710/12/20171012232816_GX5iw.thumb.224_0.jpeg" class="myInfo" id="mypic" /></div>
				<div class="mui-col-sm-8 mui-col-xs-8 writing">
					<p class="centop">
						<div class="denlu">用户名:<span id="userName" style="z-index: 99;"></span></div>
						<div class="denlu">用户id:<span id="userNumber" style="z-index: 99;"></span></div>
						<div class="denlu" id="onlyPs">配送数量：<span id="psNumber" style="z-index: 99;"></span></div>
						<div class="denlu" id="onlyGuide">手机号：<span id="guidesPhone"></span> <span id='bindPhone' style="background-color: orange;color: white;font-size: 10px;padding: 2px;border-radius: 3px;display: none;">绑定手机号</span></div>
					</p>
				</div>
				<img class="dao shezhi" style="top: 8px;width: 36px;" src="../../images/center/shizhi.png" />
				<div onclick="goMessage()">
					<img class="dao" style="top: 8px;width: 36px;right: 50px;" src="../../images/center/message.svg" />
					<span class="mui-badge mui-badge-green" style="right: 54px;position: absolute;padding: 4px;top: 6px;"></span>
				</div>
			</div>
		</div>
		<!--配送员-->
		<div class="centerList distributionN bgcwt">
			<div class="flexRow2">
				<div class="rightBorder" onclick="agencyFund()">
					<img src="../../images/center/getmoney.svg"/>代收款
				</div>
				<div class="" onclick="openPalette()">
					<img src="../../images/center/color.svg"/>调色板
				</div>
			</div>
		</div>
		<div style="padding-top: 0!important;margin-top: 5px;">
			<div class="notice">
				<div class="tab-hd tab-hdtwo" id="tabLink">
					<ul class="tab-nav ft16">
					  <li class="active aClick " data-statusId="">待配送</li>
					  <li class="aClick" data-statusId="1">待取货</li>
					  <li class="aClick" data-statusId="2">欠款审核</li>
					  <li class="aClick" data-statusId="3">已完成</li>
					</ul>
				</div>
				<!--列表loading-->
				<div id="loadingdiv" style="text-align: center;font-size: 14px;height:32px;
					line-height: 30px;color: #666;-webkit-transition: all .3s;overflow: hidden;">
					<img style="width: 30px;margin-top:5px;" src="../../img/Rolling.svg"/>
				</div>
				<!--列表loading结束-->
				<div id="infoListDiv"><!--内容-->
				</div>
				<script id="infoList" type="text/html">
					<%for(var i=0;i<list.length;i++){%>
						<%if(listType == 2){%>
							<div class="checkList" onclick="goInfo('<%=list[i].orderNumber%>')">
								<h4 class="fineB ft16">
									<span>出货单号：<%=list[i].orderNumber%></span>
									<span class="mui-icon mui-icon-arrowright mui-pull-right ft20 maincl"></span>
									<span class="h4span3">
										<%=list[i].status%>
									</span>
								</h4>
								<div class="checkListCon clearfix afterBorder ft15">
									<div class="flexr">
										<div>
											<span class="disablecl">
												顾客：
											</span>
											<span class="titcl">
												<%=list[i].customerName%>
											</span>
										</div>
										<div id="">
											<span class="disablecl">
												电话：
											</span>
											<span class="titcl">
												<a class="titcl" href="tel:<%=list[i].customerPhone%>"><%=list[i].customerPhone%></a>
											</span>
										</div>
									</div>
									<div class="flexr">
										<div>
											<span class="disablecl">
												导购：
											</span>
											<span class="titcl">
												<%=list[i].sellerName%>
											</span>
										</div>
										<div>
											<span class="disablecl">
												电话：
											</span>
											<span class="titcl">
												<a href="tel:<%=list[i].sellerPhone%>"><%=list[i].sellerPhone%></a>
											</span>
										</div>
									</div>
									<div class="ft15"><span class="maincl">配送地址：</span><span class="titcl"><%=list[i].distributionAddress%></span><img src="../../images/order/map.svg" onclick="goMap('<%=list[i].distributionAddress%>')" style="width: 30px;vertical-align: bottom;margin-top: 5px;" class="mui-pull-right"/></div>
									<div class="ft15"><span class="maincl">配送日期：</span><span class="titcl"><%=list[i].distributionTime%></span></div>
								</div>
	
								<div class="checkListB beforeBorder">
								  <span class="titcl">代收款：</span><span class="activecl">¥<%=list[i].agencyMoney%></span>
									
								</div>
							</div>
						<%}else if(listType == 0){%>
							<div class="checkList" onclick="goInfo('<%=list[i].orderNumber%>')">
								<h4 class="fineB ft16">
									<span>出货单号：<%=list[i].shipperNumber%></span>
						    			<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
								</h4>
								<div class="checkListCon clearfix afterBorder ft15">
									<div class="flexr">
										<div>
											<span class="disablecl">
												顾客：
											</span>
											<span class="titcl">
												<%=list[i].receiver%>
											</span>
										</div>
										<div id="">
											<span class="disablecl">
												电话：
											</span>
											<span class="titcl">
												<a href="tel:<%=list[i].receiverPhone%>"><%=list[i].receiverPhone%></a>
											</span>
										</div>
									</div>
									<div class="flexr">
										<div>
											<span class="disablecl">
												导购：
											</span>
											<span class="titcl">
												<%=list[i].sellerName%>
											</span>
										</div>
										<div>
											<span class="disablecl">
												电话：
											</span>
											<span class="titcl">
												<a href="tel:<%=list[i].sellerPhone%>"><%=list[i].sellerPhone%></a>
											</span>
										</div>
									</div>
									<div class="ft15"><span class="disablecl">配送地址：</span><span class="titcl"><%=list[i].shippingAddress%></span><img src="../../images/order/map.svg" onclick="goMap('<%=list[i].shippingAddress%>')" style="width: 30px;vertical-align: bottom;margin-top: 5px;" class="mui-pull-right"/></div>
									<div class="ft15"><span class="disablecl">配送日期：</span><span class="titcl"><%=list[i].deliveryTime%></span></div>
								</div>
	
								<div class="checkListB beforeBorder">
								  <span class="titcl">代收款：</span><span class="activecl">¥<%=list[i].collectionAmount%></span>
									
								</div>
							</div>
						<%}else if(listType == 1){%>
							<div class="checkList" onclick="goInfo('<%=list[i].orderNumber%>')">
								<h4 class="fineB ft16">
									<span>出货单号：<%=list[i].shipperNumber%></span>
						    			<span class="mui-icon mui-icon-arrowright mui-pull-right maincl ft20 maincl"></span>
								</h4>
								<div class="checkListCon clearfix afterBorder ft15">
									<div class="flexr">
										<div>
											<span class="disablecl">
												顾客：
											</span>
											<span class="titcl">
												<%=list[i].receiver%>
											</span>
										</div>
										<div id="">
											<span class="disablecl">
												电话：
											</span>
											<span class="titcl">
												<a href="tel:<%=list[i].receiverPhone%>"><%=list[i].receiverPhone%></a>
											</span>
										</div>
									</div>
									<div class="flexr">
										<div>
											<span class="disablecl">
												导购：
											</span>
											<span class="titcl">
												<%=list[i].sellerName%>
											</span>
										</div>
										<div>
											<span class="disablecl">
												电话：
											</span>
											<span class="titcl">
												<a href="tel:<%=list[i].sellerPhone%>"><%=list[i].sellerPhone%></a>
											</span>
										</div>
									</div>
									<div class="ft15"><span class="disablecl">配送地址：</span><span class="titcl"><%=list[i].shippingAddress%></span><img src="../../images/order/map.svg" onclick="goMap('<%=list[i].shippingAddress%>')" style="width: 30px;vertical-align: bottom;margin-top: 5px;" class="mui-pull-right"/></div>
									<div class="ft15"><span class="disablecl">配送日期：</span><span class="titcl"><%=list[i].deliveryTime%></span></div>
								</div>
	
								<div class="checkListB beforeBorder">
								  <span class="titcl">代收款：</span><span class="activecl">¥<%=list[i].collectionAmount%></span>
									
								</div>
							</div>
						<%}%>
						
					<%}%>
					 
				</script>
			</div>
		</div>
	</body>
	<script src="../../js/default.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		function goInfo(audi){
			openview({
				view:'deliveryInfo.html',
				id:'deliveryInfo',
				extrasobj:{orderNumber:audi}
			})
		}
		function goMap(address){
			event.stopPropagation();
			openview({
				view:'addressMap.html',
				id:'addressMap',
				extrasobj:{address:address}
			})
		}
		//消息
		function goMessage(){
			openview({
				view:'../personal/message.html',
				id: 'message',
			})
		}
		function agencyFund(){
			openview({
				view:'agencyFund.html',
				id:'agencyFund'
			})
		}
		//调色版
		function openPalette(){
			openview({
				view:'../personal/palette.html',
				id: 'palette',
			})
		}
		mui.plusReady(function(){
			var userId = plus.storage.getItem('$userId');
			var oldToken = plus.storage.getItem("oldToken");
			var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
			document.addEventListener('refresh', function() {
				Refresh();
			})
			Refresh();
			function Refresh() { //刷新
				//获取缓存
				var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
				var userId = plus.storage.getItem('$userId');
				var oldToken = plus.storage.getItem('oldToken');
				loadmyinfo();
				 
				/*设置*/
				mui('.shezhi')[0].addEventListener('tap',function(){
					openview({
						view:'../personal/shezhi.html',
						id:'shezhi'
					});
				});

				function loadmyinfo() {
					//个人信息
					mui.ajax(serverUrl+'/app/user/homepage', {
						data: {
							userId: userId,
							identityType: identityT
						},
						dataType: 'json',
						headers: {
							"Authorization": oldToken
						},
						type: 'post',
						timeout: 10000,
						success: function(data, type, xhr) {
							console.log('个人信息', data);
							if(data.code == 0) {
								plus.nativeUI.closeWaiting();
								if(data.content) {
									if(data.content.cityId){
										plus.storage.setItem('userCity',data.content.cityId.toString())
									}
									if(data.content.picUrl) {
										$('#mypic').attr('src', data.content.picUrl)
									}else{
										$('#mypic').attr('src', '../../img/editset.png')

									}
									$('#userName').html(data.content.name)
									$('#userNumber').html(data.content.number)
									if(data.content.mobile) {
										plus.storage.setItem('mobile',data.content.mobile);
									}
									if(identityT == 1){
										if(data.content.mobile) {
											$('#guidesPhone').html(data.content.mobile)
										}
										if(data.content.sendQty){
											$('#psNumber').html(data.content.psNumber)
										}else{
											$('#psNumber').html('0')
											
										}
									}
								}
							} else {
								mui.toast(data.message)
							}

						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting();
							console.log('登录响应失败');
						}
					});
				}
			} //刷新
			
			$('#tabLink li').click(function(){
				$('#tabLink li').removeClass('active');
				$(this).addClass('active');
				$('#loadingdiv').css('height','32px');
				loadFun($(this).index());
			})
			$('#center').click(function(){
				openview({
					view:'../../center.html',
					id:'center'
				})
			})
			document.addEventListener('refresh', function(event) {
				loadFun('');
			});
			loadFun('');
			function loadFun(index){
				if(index == 2){
					var apiString = '/app/arrearsAudit/list';
					var data = {'userId':userId,'identityType':identityT}
				}else if(index == 0){
					var apiString = '/app/dispatching/list';
					var data = {'userID':userId,'identityType':identityT}
				}else if(index == 1){
					var apiString = '/app/dispatching/pickUp/list';
					var data = {'userID':userId,'identityType':identityT}
				}
				mui.ajax(serverUrl+apiString,{
					data:data,
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"Authorization":oldToken},
					success:function(data,type,xhr){
						console.log('配送员各列表 ',data);
						var timeLoad = setInterval(function(){
							clearTimeout(timeLoad),timeLoad = null;
							if(data.code == 0){
								$('#loadingdiv').css('height','0px');
								if(data.content && data.content.length){ 
									document.getElementById('infoListDiv').innerHTML = template('infoList',{list:data.content,listType:index});
								}else{
									document.getElementById('infoListDiv').innerHTML = '<div style="text-align: center;padding: 50px;"><img src="../../images/order/order.png" style="width: 100px;" /><div class="ft13 disablecl">暂无数据</div></div>';
								}
								
							}else{
								mui.toast(data.message);
							}
						},500)
					},
					error:function(xhr,type,errorThrown){
						console.log('响应失败  !');
					}
				});
			}
			
		})

		var backButtonPress = 0;
		mui.back = function(event) {
			backButtonPress++;
			if(backButtonPress > 1) {
				plus.runtime.quit();
			} else {
				plus.nativeUI.toast('再按一次退出应用');
			}
			setTimeout(function() {
				backButtonPress = 0;
			}, 1000);
			return false;
		};
	</script>
</html>
