<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>出货信息</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/commonY.css">
		<link rel="stylesheet" type="text/css" href="../../css/configW.css"/>
		<style type="text/css">
			.Dpart1{padding: 15px 15px 5px;background-color: #fff;line-height: 2.5;margin-bottom: 7px;}
			.Dpart1 h4{font-size: 16px;}
			.Dpart1 h4 span{color: #AC0100;}
			.Dpart1 h4 span.span1{text-decoration: underline;margin-left: 10px;}
			.Dpart1 p span.span2{float: right;}
			.Dpart2{padding: 2px 15px;}
			.huiC{color:#8f8f94}
			.Dpart3{padding: 10px 15px;background-color: #fff;line-height: 1.8;margin-bottom: 7px;}
			.redC{color: #AC0100;}
			.floL{float: right;}
			.proWrapAll{background-color: #fff;margin-bottom: 10px;}
			.proWrap{display: -webkit-flex;padding: 15px;}
			.proLeft{flex: 2;}
			.proLeft img{width: 100%;height: 100%;}
			.proRight{flex: 5;padding-left: 20px;}
			.proRight h4{display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;overflow: hidden;font-size: 16px;line-height: 1.3;}
			.proRight p, .proRight div{margin-top: 2%;}
			.proRight div .span2{float: right;color: #7F8080;}
			.proRight div .span1{font-size: 18px;color: #EE9000;}
			.footBtn{background-color: #fff;position: fixed;bottom: 0;width: 100%;box-shadow: 0 0 2px rgba(175, 166, 166, 0.85) !important;display: flex;flex: 1;text-align: center;justify-content: space-around;}
			.footBtn div{padding: 12px;flex: 1;}
			.Dpart1 h4:after{content: '复制';}
			.checkList{background-color: #fff;margin-top: 10px;}
			.checkList h4{padding: 12px 10px;}
			.checkList h4 .h4span3{float: right;color: red;}
			.checkList h4 .h4span2{margin-left: 3%;}
			.checkListCon{padding: 10px;line-height: 2;}
			.checkListDZ{padding: 10px 0;color: #757575;font-size: 16px;}
			.checkListB{padding: 10px 20px;text-align: right;}
			#infoListDiv{transition: all .3s;}
			.flexr{display: -webkit-flex;-webkit-justify-content: space-between;margin: 2px 0;}
			a,a:active{color: rgb(51,51,51)!important;}
			.mui-bar .mui-title{right: 60px!important;}
			.titcl img{width: 25px;vertical-align: middle;}

		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav fineB" style="padding-right: 15px;">
			<a id="leftbtn" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" style="pointer-events:all">出货信息</h1>
			<div class="mui-pull-right activecl" style="margin-top: 15px;z-index: 9999;" onclick="gowl()">物流状态</div>
		</header>
		<script src="../../js/statusBar.js"></script>

		<div id="main">
			<div id="infoListDiv"></div>
			<script type="text/html" id="infoList">
				<div class="checkList">
					<h4 class="fineB ft16">
						<span>出货单号：<%=list.orderNumber%></span>
					</h4>
					<div class="checkListCon clearfix afterBorder ft15">
						<div class="flexr">
							<div>
								<span class="disablecl">
									联系人：
								</span>
								<span class="titcl">
									<%=list.receiver%>
								</span>
							</div>
							<div id="">
								<span class="disablecl">
									电话：
								</span>
								<span class="titcl">
									<a href="tel:<%=list.receiverPhone%>"><%=list.receiverPhone%> <img src="../../images/center/tel.svg" alt="" /></a>
								</span>
							</div>
						</div>
						<div class="flexr">
							<div>
								<span class="disablecl">
									导&nbsp;&nbsp;&nbsp;&nbsp;购：
								</span>
								<span class="titcl">
									<%=list.sellerName%>
								</span>
							</div>
							<div>
								<span class="disablecl">
									电话：
								</span>
								<span class="titcl">
									<a href="tel:<%=list.sellerPhone%>"><%=list.sellerPhone%> <img src="../../images/center/tel.svg" alt="" /></a>
								</span>
							</div>
						</div>
						<div class="ft15"><span class="disablecl">配送地址：</span><span class="titcl"><%=list.shippingAddress%></span></div>
						<div class="ft15"><span class="disablecl">配送日期：</span><span class="titcl"><%=list.deliveryTime%></span></div>
					</div>
					<%if(list.collectionAmount){%>
						<div class="checkListB beforeBorder">
						  <span class="titcl">代收款：</span><span class="activecl">¥<%=list.collectionAmount%></span>
						</div>
					<%}%>

				</div>

				<div class="proWrapAll" style="margin-top: 10px;">
					<div class="afterBorder ft15 typeShowYou" style="padding: 10px;">
						订单编号：<%=list.returnNumber%>
					</div>
					<%for(var i = 0 ;i<list.goodsList.length;i++){%>
						<div class="proWrap fineB">
							<div class="proLeft">
								<img src="<%=list.goodsList[i].coverImageUri || '../../img/editset.png'%>"/>
							</div>
							<div class="proRight">
								<h4><%=list.goodsList[i].skuName%></h4>
								 <%if(list.goodsList[i].sku){%>
									<div class="ft14 maincl">商品编码:<%=list.goodsList[i].sku%></div>
								<%}%>
								<p>规格：<%=list.goodsList[i].goodsSpecification%>  单位：<%=list.goodsList[i].goodsUnit%></p>
								<div class="">
									<span class="span1">¥<%=list.goodsList[i].retailPrice%></span>
									<span class="span2">x<%=list.goodsList[i].qty%></span>
								</div>
								<%if(list.goodsList[i].isGift){%>
									<span class="mui-badge mui-badge-danger">
										赠品
									</span>
								<%}%>
							</div>
						</div>
					<%}%>

				</div>
				<div class="footBtn">
					<div class="aClick maincl" style="background-color: #DDDDDD;" onclick="refuse('<%=list.orderNumber%>')">拒收</div>
					<div class="aClick" style="background-color: #B42E28;color: white;" onclick="receipt('<%=list.orderNumber%>','<%=list.collectionAmount%>')">确认收货</div>
				</div>
			</script>


		</div>
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/default.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			function refuse(orderNumber){
				openview({
					view:'refuse.html',
					id:'refuse',
					extrasobj:{orderNumber:orderNumber}
				})
			}
			function receipt(orderNumber,money){
				openview({
					view:'receipt.html',
					id:'receipt',
					extrasobj:{orderNumber:orderNumber,money:money}
				})
			}
			mui.plusReady(function(){
				var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
				var userId = plus.storage.getItem('$userId');
				var oldToken = plus.storage.getItem('oldToken');
				var orderNumber = plus.webview.currentWebview().orderNumber;
				var ordertype = plus.webview.currentWebview().orderType;
				if(ordertype == 3){
				 	var	isOver = 1
				}else{
				 	var	isOver = 0
				}

				plus.nativeUI.showWaiting();
				mui.ajax(serverUrl+'/app/dispatching/shipper/detail',{
					data:{userID:userId,identityType:identityT,orderNumber:orderNumber},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"Authorization":oldToken},
					success:function(data,type,xhr){
						console.log('出货信息 ',data);
						if(data.code == 0){

							if(data.content && data.content.goodsList){
								document.getElementById('infoListDiv').innerHTML = template('infoList',{list:data.content});
								if(ordertype == 0){
									$('.footBtn .maincl').show();
								}else{
									$('.footBtn').hide();
								}
							}else{
								document.getElementById('infoListDiv').innerHTML = '<div style="text-align: center;padding: 50px;"><img src="../../images/order/order.png" style="width: 100px;" /><div class="ft13 disablecl">暂无数据</div></div>';
							}
							//配送员待配送的出货信息页面订单编号去掉
							if(ordertype == 0){
								mui('.typeShowYou')[0].innerHTML = '商品列表';
							}
							plus.nativeUI.closeWaiting()
						}else{
							mui.toast(data.message);
						}
					},
					error:function(xhr,type,errorThrown){
						console.log('响应失败  !');
					}
				});

				window.gowl = function(){
					openview({
						view:"dispatchingWl.html",
						id:'dispatchingWl',
						extrasobj:{orderNo:orderNumber,isOver:isOver}
					})
				}
			})
		</script>
	</body>

</html>