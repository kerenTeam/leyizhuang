<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/configW.css" />
		<style type="text/css">
		.circle {
            width: 200px;
            height: 200px;
            position: absolute;
            border-radius: 50%;
            background: #0cc;
            top: 20%;
            left: 50%;
            -webkit-transform: translateX(40%);
        }
        .pie_left, .pie_right {
            width:200px; 
            height:200px;
            position: absolute;
            top: 0;left: 0;
        }
        .left, .right {
            width:200px; 
            height:200px;
            background:#CCCCCC;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 0;
        }
        .pie_right, .right {
            clip:rect(0,auto,auto,100px);
        }
        .pie_left, .left {
            clip:rect(0,100px,auto,0);
        }
        .mask {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            left: 25px;
            top: 25px;
            background: #FFF;
            position: absolute;
            text-align: center;
            line-height: 130px;
            font-size: 16px;
            color: #00aacc;
        }
        .totalEdu{
        	 	position: absolute;
            line-height: 130px;
            font-size: 16px;
            color: #00aacc;
            left: 60px;
            text-align: center;
            top: 45px;
        }
        .alledu{
        	position: absolute;
        	top: 60%;
        	left: 50%;
        	-webkit-transform: translateX(-50%);
        	text-align: center;
        }
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="padding-right: 15px;">
			<a id="leftbtn" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">xxx装饰</h1>
			<a class="mui-pull-right editAll" id="bianji" style="line-height: 50px;color: #555;">明细查看</a>
		</header>
		<div class="mui-content">
			<div class="circle" style="left:0">
				<div class="pie_left">
					<div class="left"></div>
				</div>
				<div class="pie_right">
					<div class="right"></div>
				</div>
				<div class="mask">剩余额度<span id="availableBalance">0</span></div>
				<div class="totalEdu">总额度<span id="totalBalance"></span></div>
			</div>
			<div class="alledu">
				<div id="limitbalance">
					固定额度：<span></span>
				</div>
				<div id="tempbalance">
					临时额度：<span></span>
				</div>
			</div>
		</div> 
		
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/default.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init();
			function addPercent(num) {
				if(num > 100) return;
				var c = document.getElementsByClassName("circle")[0];
//				c.getElementsByTagName("span")[0].innerHTML = num;
				num = num * 3.6;
				if(num <= 180) {
					c.getElementsByClassName("right")[0].style.transform = "rotate(" + num + "deg)";
				} else {
					c.getElementsByClassName("right")[0].style.transform = "rotate(180deg)";
					c.getElementsByClassName("left")[0].style.transform = "rotate(" + (num - 180) + "deg)";
				}

			}
 
			mui.plusReady(function() {
				//获取缓存 
				var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
				var userId = plus.storage.getItem('$userId');
				var oldToken = plus.storage.getItem('oldToken');
				plus.nativeUI.showWaiting();
				mui.ajax(serverUrl + '/app/employee/creditMoney/balance', {
					data: {
						userId: userId,
						identityType: identityT
					},
					dataType: 'json',
					headers: {
						"Authorization": oldToken
					},
					type: 'post',
					timeout: 10000,
					success: function(data, type, xhr) {
						plus.nativeUI.closeWaiting();
						console.log('门店信用金', data);
						if(data.code == 0) {
							plus.nativeUI.closeWaiting();
							if(data.content) {
								$('#limitbalance span').html('¥'+data.content.limitBalance)
								$('#tempbalance span').html('¥'+data.content.tempBalance)
								$('#availableBalance').html('¥'+data.content.availableBalance)
								$('#totalBalance').html('¥'+(data.content.tempBalance+data.content.limitBalance))
								
								var count = (data.content.availableBalance / (data.content.tempBalance+data.content.limitBalance)) * 100,
									i = 0;
								var t = setInterval(function() {
									if(i < count) {
										addPercent(++i);
									}
					
								}, 10);
								
							}

						}
						if(data.code == 1000) {
							mui.toast(data.message)
						} else if(data.code == -1) {
							mui.toast(data.message)
						}

					},
					error: function(xhr, type, errorThrown) {
						plus.nativeUI.closeWaiting();
						mui.toast(type)
						console.log('登录响应失败');
					}
				});
			})
		</script>
	</body>

</html>