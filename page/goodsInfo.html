<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>商品详情</title>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, width=device-width">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-touch-fullscreen" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="address=no">  
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css"/> 
		<link rel="stylesheet" type="text/css" href="../css/commonY.css"> 
		<link rel="stylesheet" href="../css/resetY.css" />
		<link rel="stylesheet" type="text/css" href="../css/configW.css"/> 
		 <link rel="stylesheet" type="text/css" href="../css/style.css"/>
	</head>
	<style type="text/css">
		.baocun{text-align:right;}
		.baocun img{vertical-align:middle;width: 30px;}
		.listCon{border-bottom: 10px solid #f3f3f3;}
		.listCon p{padding:10px 0 0}
		.follow{position:relative;}
		.follow{background-color:#fff;padding:15px 10px;}
		.follow:after{position:absolute;right:10px;bottom:0;left:10px;height:1px;background:#cacaca;content:'';-webkit-transform:scaleY(.3);}
		.follow:last-child:after{height:0;}
		.fchidl{display:flex;align-items:center;justify-content:space-between;}
		.userAvator{margin-right:10px;width:2.5rem;height:2.5rem;border-radius:50%;}
		.userAvator3{margin-right:10px;width:2rem;height:2rem;border-radius:50%;}
		.fchidl>div{display:flex;vertical-align:middle;text-align:left;font-size:15px;align-items:center;}
		.text{color:#999;}
  		.flexrr{display: flex;justify-content: space-between;align-items: center;padding: 15px 0;}
  		.flexrr>div img{width: 20px;vertical-align: middle;}
  		.cmtall img{width: 25px;margin-right: 5px;}
  		.cmtflex{display: flex;justify-content: space-between;align-items: center;}
  		.ctc span{color: #fb7e23;}
  		ul{list-style: none;padding: inherit;margin: 0;}
	   	.diybtn{background: url(../img/makeFriend/follow.png) no-repeat;background-size: 100% 100%;background-position: left top;color: white;padding: 4px 22px;}
  		.diybtn2{background: url(../img/makeFriend/unfollw.png) no-repeat;background-size: 100% 100%;background-position: left top;color: #31c58b;padding: 4px 22px;}
		.yhm{width:calc((100vw - 50px)/3);width:-webkit-calc((100vw - 50px)/3);width:-moz-calc((100vw - 50px)/3);height: calc((100vw - 20px)/3);height: -webkit-calc((100vw - 20px)/3);height: -moz-calc((100vw - 20px)/3);margin-left: 5px;margin-top:10px ;}
		.giveBk{background: url(../img/makeFriend/give.png) no-repeat;background-size: 100% 100%;background-position: left top;color: #31c58b;padding: 6px 25px;color: white;}
		.fchidl2{display: flex;}
		.fchidl2 .butright{flex-grow: 1;}
		.fchidl2 .btop{display: flex;justify-content: space-between;align-items: center;}
		.fchidl3 .btop{display: flex;justify-content: flex-start!important;align-items: center;}
		.opbot{display: flex;height: 50px;align-items:center;position: fixed;bottom: 0;left: 0;right: 0;background-color: white;box-shadow: 0px 1px 1px 1px #EEEEEE;}
		.opbf{flex-grow: 1;display: flex;justify-content: space-around;align-items: center;}
		.opbf>div{flex: 1;text-align: center;}
		.opbb{width: calc(100vw * 0.5);width: -webkit-calc(100vw * 0.5);width: -moz-calc(100vw * 0.5);text-align: center;background-color: #f93a38;color: white!important;height: 100%;line-height: 50px;}
		.writecmt{flex-grow: 1;background: url(../img/makeFriend/cmtbor.png) no-repeat bottom;padding: 5px;max-height: 80px;overflow-y: scroll;}
		.opbot img{width: 25px;height:25px;margin: 0 3px;vertical-align: middle;}
		.follow .maincl{letter-spacing: 0.4px;line-height: 1.5;}
		.follow b{font-weight: 600;color: #FD6363;}
		.fchidl3{padding: 10px 10px;border-left: 1px solid #ccc;}
		.DTcontent{overflow: hidden;}
		.dynamicPic{float: left;position: relative;overflow: hidden;border-right: 2px solid #fff;}
		.dynamicPic1{width: 70%;padding-top: 68%;}
		.dynamicPic2{width: 50%;padding-top: 48%;}
		.dynamicPic3{width: 33%;padding-top: 31%;}
		.dynamicPic img{width: 100%;}
		#maskInfo{z-index:99999;position:fixed;top:0;left:0;width:100%;bottom:0;background-color:rgba(0,0,0,.5)}	
		.dynamicPic span{display: inline-block;position: absolute;top: 2%;left: 2%;width: 96%;height: 96%;background-color: #F3F3F3;overflow: hidden;}
		.mui-slider-item img{
			width: 100%!important;
		}
		#goodsInfo{margin: 10px 0;background-color: white;padding: 10px;}
		#goodsInfo img{width: 100%;}
	</style>

	<body style="background-color: white;">

		<header class="mui-bar mui-bar-nav" id="header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left bigSize back"></a>
			<h1 class="mui-title findUser">商品详情</h1>
		</header>
		<script src="../js/statusBar.js"></script><!--状态栏-->
		<div class="mui-content" style="margin-bottom: 60px;">
			<div id="moll_info"></div>
			
			<script type="text/html" id="infoTpl">
				<div class="mui-slider">
					<!--轮播图-->
					<%if(dataobj.rotationImageUriList.length){%>
						<div class="mui-slider-group mui-slider-loop">
						    <!--支持循环，需要重复图片节点-->
						    <div class="mui-slider-item mui-slider-item-duplicate">
						    	<img src="<%= dataobj.rotationImageUriList[dataobj.rotationImageUriList.length-1] %>" onerror="javascript:this.src='../images/img.svg';" />
						    </div>
							<% for(var i=0;i<dataobj.rotationImageUriList.length;i++){ %> 
						    	<div class="mui-slider-item">
						    		<img src="<%=dataobj.rotationImageUriList[i] %>"  onerror="javascript:this.src='../images/img.svg';"/>
						    	</div>
						     <% } %>
						    <!--支持循环，需要重复图片节点-->
						    <div class="mui-slider-item mui-slider-item-duplicate" >
						    	<img src="<%=dataobj.rotationImageUriList[0] %>" onerror="javascript:this.src='../images/img.svg';" />
						    </div>
						</div>
						<div class="mui-slider-indicator">
							<div class="mui-indicator mui-active"></div>
							<% for(var i=0;i<dataobj.rotationImageUriList.length-1;i++){ %>
						    	<div class="mui-indicator"></div>
						    <% } %>
			            </div> 
					<%}%>
				</div>
				<!--轮播图结束-->
				<div id="brief" style="background: white;padding: 15px;font-size: 14px;">
					<%=dataobj.skuName%><br/>
					<span>价格：¥<%=dataobj.price%>  规格：<%=dataobj.goodsSpecification%>  单位：<%=dataobj.goodsUnit%><br/></span>
				</div>
				<!--详情-->
				<div id="goodsInfo">
					<div style="line-height: 0.8;"> 
						<div class="ft14">商品详情</div> 
					</div>
					<% for(var i=0;i<dataobj.coverImageUriList.length;i++){ %>
						<%if(dataobj.coverImageUriList[i]){%>
							<img src="<%=dataobj.coverImageUriList[i]%>" alt="" />
							
						<%}%>
				    	<div class="mui-indicator"></div>
				    <% } %>
				</div>
			</script>
    			<!--留言--> 
			<div class="follow cmtflex">
				<div style="text-align: center;line-height: 0.8;"> 
					<div class="ft14">评论</div> 
				</div>
			</div>
			<div id="curShow"></div>
		 	<script type="text/html" id="cmtTpl">
		 		
		 		<%for(var i=0;i<list.length;i++){%>
					<%if(!list[i].commontid){%>
						<div class="follow ft12"> 
							<div class="fchidl2">
								<div class="ctc">
									<img src="<%=list[i].avatar%>" class="userAvator loadPics"/>
								</div> 
								<div class="butright">
									<div class="ft12 btop">
					            		<b class="ft14"><%=list[i].nickname%></b> <span class="disablecl"><%=list[i].create_time%></span>
					            	</div>
					            	<div class="maincl ft14" data-toName="<%=list[i].nickname%>" data-userId="<%=list[i].userid%>" data-cmtId="<%=list[i].id%>"><%=list[i].commont%></div>
					           </div> 
							</div>
						</div>
						<%}else{%>
							 
							<div class="follow ft12"> 
	                            <div class="fchidl2">
	                                <div class="ctc">
	                                    <img src="<%=list[i].avatar%>" class="userAvator loadPics"/>
	                                </div> 
	                                <div class="butright">
	                                    <div class="ft12 btop">
	                                        <b class="ft14"><%=list[i].nickname%></b> <span class="disablecl"><%=list[i].create_time%></span>
	                                    </div>
	                                    <div class="maincl ft14" data-toName="<%=list[i].nickname%>" data-userId="<%=list[i].userid%>" data-cmtId="<%=list[i].id%>"><%=list[i].commont%></div>
	                                    <div class="cmtChild" data-toUserId="<%=list[i].touserid%>" data-toCmtId="<%=list[i].commontid%>"></div>
	                               </div> 
	                            </div>
	                        </div>
							 
							<%}%> 
					<%}%>
		 	</script> 
			 <!--子留言-->
            <script type="text/html" id="cmtChildTpl">
                
                <%for(var i=0;i<list.length;i++){%> 
                         
                        <div class="fchidl2 fchidl3">
                            <div class="ctc">
                                <img src="<%=list[i].avatar%>" class="userAvator3 loadPics"/>
                            </div> 
                            <div class="butright">
                                <div class="ft12 btop">
                                    <b><%=list[i].nickname%></b>
                                </div>
                                <div class="maincl ft12"><%=list[i].commont%></div>
                           </div> 
                        </div>
                    <%}%>
 
            </script>
			  
		</div>
		 
		<!--底部-->
		<div class="opbot maincl ft14">
			<div class="opbf ft12">
				<div id='collt' data-id='0'>
					收藏
				</div>
				<div style="border-left: 1px solid #EEEEEE;border-right: 1px solid #EEEEEE;">
					分享
				</div>
				<div id='cmtedup'>
					评论
				</div>
			</div>
			<a href="javascript:;" class="opbb" onclick="toshare()">
				加入下料清单
			</a> 
		</div>
		
		<!--购物车弹出内容-->
		
		<div class="am-share">
			<div id="cartObj"></div>	
			<script type="text/html" id="cartTpl">
				<div class="am-share-footer">
					<span class="share_btn">
						<img src="../images/chahao.png"/>
					</span>
				</div>
				<div class="am-share-sns box-s">
					<div class="sdetail clearfloat">
						<div class="top clearfloat">
							<div class="tu clearfloat fl">
								<img src="<%=dataobj.rotationImageUriList[0] %>" data-preview-src="" /> 
							</div>
							<div class="you clearfloat fl">
								<div class="tit overflow_clear">
									<%=dataobj.skuName%>
								</div>
								<div>规格：<em><%=dataobj.goodsSpecification%></em> 单位：<em><%=dataobj.goodsUnit%></em></div>
								<span>
									<b id="priceChange">¥ <%=dataobj.price%></b> 
								</span>
							</div>
						</div>
						<div class="Mscroll">
							<div id="parBox"></div>
							<div class="bottom clearfloat">
								<p class="fl">购买数量</p>
								<div class="you clearfloat fr">
									<div class="mui-numbox margin-top" data-numbox-min="1">
										<button class="mui-btn mui-btn-numbox-minus" type="button" disabled="">-</button>
										<input id="test" class="mui-input-numbox" type="number" readonly="" value="" />
										<button id="upup" class="mui-btn mui-btn-numbox-plus add" type="button">+</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</script>
			
			<a class="shop-btn db">确定</a>
		</div>
		
	 </body>
	<script type="text/javascript" src="../js/jquery.min.js"></script>
	<script src="../js/mui.min.js"></script>
	<script src="../js/mui.zoom.js"></script>
	<script src="../js/mui.previewimage.js"></script>
	<script src="../js/artTemplate-native.js"></script>
	<script src="../js/default.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		//购物车弹出 关闭
		function toshare(){
			
			$(".am-share").addClass("am-modal-active");	
			if($(".sharebg").length>0){
				$(".sharebg").addClass("sharebg-active");
			}else{
				$("body").append('<div class="sharebg"></div>');
				$(".sharebg").addClass("sharebg-active");
			}
			$(".sharebg-active,.share_btn").click(function(){
				$(".am-share").removeClass("am-modal-active");	
				setTimeout(function(){
					$(".sharebg-active").removeClass("sharebg-active");	
					$(".sharebg").remove();	
				},300);
			})
		}
	</script>
	<script type="text/javascript">
		mui.plusReady(function(){
			var goodid = plus.webview.currentWebview().goodId;
			if(!goodid){
				mui.toast('未返回商品id')
			}
			//获取缓存 
			var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
			var userId = plus.storage.getItem('$userId'); 
			var oldToken = plus.storage.getItem('oldToken');
			plus.nativeUI.showWaiting();
			//商品详情
			mui.ajax(serverUrl+'/app/goods/get/goodsDetail',{
				data:{
					goodsId:goodid,
					userId:userId,
					identityType:identityT
				},
				dataType:'json',
				headers: {"Authorization": oldToken},
				type:'post',
				timeout:10000,
				success:function(data,type,xhr){ 
					plus.nativeUI.closeWaiting();
					console.log('商品详情',data);
					if(data.code == 0 ){
						plus.nativeUI.closeWaiting();
						if(data.content){
							if(data.content.isCollect){
								$('#collt').html('取消收藏').attr('data-id','1')
							}
							if(data.content.rotationImageUriList){
								for(var i in data.content.rotationImageUriList){
									if(!data.content.rotationImageUriList[i]){
										data.content.rotationImageUriList[i] = '../images/img.svg'
									}
								}
										 
							}
							document.getElementById("moll_info").innerHTML = template("infoTpl", {dataobj:data.content});
							document.getElementById("cartObj").innerHTML = template("cartTpl", {dataobj:data.content});
							mui('.mui-numbox').numbox()
							var gallery = mui(".mui-slider");
							gallery.slider({
								interval: 3000 //设置自动轮播周期为3s
							});
						}else{
							
						}
					}
					if(data.code == 1000 ){
						mui.toast(data.message)
					}else if(data.code == -1 ){
						mui.toast(data.message)
					}
					 
				},
				error:function(xhr,type,errorThrown){
					plus.nativeUI.closeWaiting();
					mui.toast(type)
					console.log('登录响应失败');
				}
			});
			$('#cmtedup').click(function(){
					mui.prompt('null','请输入留言','留言',['确认','取消'],function(e) {
						if(e.index == 0) { 
							if(e.value && e.value!=' '){
								var commont = e.value; 
				    			mui.ajax(serverUrl + '/api/friends/newscomment', {
				    				data:{newsId:infiId,userid:myuserid,commont:commont},
									dataType: 'json',
									type: 'POST',
									timeout: 8000,
									headers: {"token": oldToken,'city': cityNum},
									success: function(data, type, xhr) {
										console.error('留言详情', data);
										 
										if(data.errno == 0) { 
							    			mui.toast('留言成功'); 
							    			getCmt();
										}else{
											mui.toast('当前网络不好,请重试');
										}
									},
									error: function(xhr, type, errorThrown) {
										console.error('留言列表,响应失败');
										mui.toast('当前网络不好,请重试');
									}
								});
							}else{
								mui.toast('留言失败')
							}
						} 
					},'')
				
	    	})
		    	//收藏
		    	$('#collt').click(function(){
		    		if($(this).attr('data-id') == 0){
		    			mui.ajax(serverUrl+'/app/user/collect/add',{
						data:{
							goodsId:goodid,
							userId:userId,
							identityType:identityT
						},
						dataType:'json',
						headers: {"Authorization": oldToken},
						type:'post',
						timeout:10000,
						success:function(data,type,xhr){ 
							plus.nativeUI.closeWaiting();
							console.log('收藏返回',data);
							if(data.code == 0 ){
								plus.nativeUI.closeWaiting();
								$('#collt').attr('data-id','1');
								$('#collt').html('取消收藏');
								mui.toast('收藏成功');
							}
							if(data.code == 1000 ){
								mui.toast(data.message)
							}else if(data.code == -1 ){
								mui.toast(data.message)
							}
							 
						},
						error:function(xhr,type,errorThrown){
							plus.nativeUI.closeWaiting();
							mui.toast(type)
						}
					});
		    		}else{
		    			mui.ajax(serverUrl+'/app/user/collect/remove',{
						data:{
							goodsId:goodid,
							userId:userId,
							identityType:identityT
						},
						dataType:'json',
						headers: {"Authorization": oldToken},
						type:'post',
						timeout:10000,
						success:function(data,type,xhr){ 
							plus.nativeUI.closeWaiting();
							console.log('收藏返回',data);
							if(data.code == 0 ){
								plus.nativeUI.closeWaiting();
								$('#collt').attr('data-id','0');
								mui.toast('取消成功');
								$('#collt').html('收藏')
							}
							if(data.code == 1000 ){
								mui.toast(data.message)
							}else if(data.code == -1 ){
								mui.toast(data.message)
							}
							 
						},
						error:function(xhr,type,errorThrown){
							plus.nativeUI.closeWaiting();
							mui.toast(type)
						}
					});
		    		}
		    		
		    	})
	    
			//加入购物车
			$('.shop-btn').click(function(){
				
				mui.ajax(serverUrl+'/app/materialList/add',{
					data:{
						userId:userId,
						identityType:identityT,
						params:goodid+'-'+$('#test').val()
					},
					dataType:'json',
					headers: {"Authorization": oldToken},
					type:'post',
					timeout:10000,
					success:function(data,type,xhr){ 
						plus.nativeUI.closeWaiting();
						console.log('加入购物车',data);
						if(data.code == 0 ){
							plus.nativeUI.toast('加入成功')
							$(".am-share").removeClass("am-modal-active");
							$(".sharebg ").removeClass("sharebg-active");							
							mui.fire(plus.webview.getWebviewById('cart.html'), 'refresh');
							 
						}else{
							mui.toast(data.message)
						}
						 
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.closeWaiting();
						mui.toast(type)
						console.log('登录响应失败');
					}
				});
			})
		}) 
		
		//发布时间判断 
		var minute = 1000 * 60;
		var hour = minute * 60;
		var day = hour * 24;
		var halfamonth = day * 15;
		var month = day * 30;
		function getDateDiff(dateTimeStamp){ 
			var now = new Date().getTime(); 
			var diffValue = now - dateTimeStamp; 
			var monthC =diffValue/month;
			var weekC =diffValue/(7*day);
			var dayC =diffValue/day;
			var hourC =diffValue/hour;
			var minC =diffValue/minute;
			if(monthC>=1){
			 result=parseInt(monthC) + "月前";
			 }
			 else if(weekC>=1){
			 result=parseInt(weekC) + "周前";
			 }
			 else if(dayC>=1){
			 result=parseInt(dayC) +"天前";
			 }
			 else if(hourC>=1){
			 result=parseInt(hourC) +"小时前";
			 }
			 else if(minC>=1){
			 result=parseInt(minC) +"分钟前";
			 }else{ 
			 result="刚刚";
			 }
			return result;
		}
//		 		mui.previewImage(); 
		
	</script>

</html>