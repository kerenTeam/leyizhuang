<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/commonY.css" />
		<!--<link rel="stylesheet" href="css/style.css" />-->
		<link rel="stylesheet" type="text/css" href="css/configW.css" />
	</head>
	<style type="text/css">
		.vct {
			width: 90%;
			position: fixed;
			color: white;
			text-align: center;
			top: 22%;
			left: 5%;
		}

		.vct img {
			display: block;
			width: 80px;
			margin: auto;
			margin-bottom: 10px;
			vertical-align: middle;
		}

		.vct td {
			padding: 20px;
		}

		#close {
			width: 80px;
			padding: 20px;
		}

		.imgpt {
			position: relative;
			width: 100%;
			padding-top: 54%;
			overflow: hidden;
		}

		.imgpt img {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}

		.clasfyItem {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			text-align: center;
			display: flex;
			display: -webkit-flex;
			align-items: center;
    		-webkit-justify-content: center;
    		justify-content: center;
			/*background-color: rgba(0,0,0,0.3);*/
			-webkit-transition: all 0.5 ease;
		}
		.clasfyItem .itemName {
			color: white;
			font-size: 20px;
			font-weight: 400;
		}

		.trangle {
			position: absolute;
			bottom: 0;
			left: 1.2rem;
			width: 0px;
			height: 0px;
			border-top: 11px solid transparent;
			border-right: 11px solid transparent;
			border-bottom: 11px solid white;
			border-left: 11px solid transparent;
		}

		.npbk {
			overflow-x: hidden;
			width: 100vw;
			position: relative;
			left: 50%;
			right: 50%;
			margin-left: -50vw;
			margin-right: -50vw;
		}

		.npbk ul {
			margin: 10px 0px 10px 5px;
			position: relative;
			white-space: nowrap;
			overflow-x: scroll;
		}

		.npbk ul:not(:last-of-type):after {
			position: absolute;
			content: '';
			height: 1px;
			-webkit-transform: scaleY(0.3);
			background-color: #EEEEEE;
			left: 0;
			right: 0;
			bottom: 0;
			transform-origin: bottom;
		}

		.nplist {
			width: 1.3rem;
			/*height: 1.3rem;*/
			text-align: center;
			display: inline-block;
			margin-bottom: 10px;
			/*border: 1px solid #efefef;*/
			box-shadow: 0px 0 5px 0px rgba(0, 0, 0, 0.1);
			margin-left: 5px;
		}

		.nplast {
			height: 1.3rem;
			/*text-align: center;*/
			line-height: 1.3rem;
			color: #f53c42;
			border: 1px solid #eee;
			position: absolute;
			top: 0;
		}

		.nplist h4 {
			color: black;
			font-size: 0.14rem;
			width: 1rem;
			line-height: 2;
			text-overflow: ellipsis;
			white-space: nowrap;
			overflow: hidden;
			margin: auto;
		}

		.npimg {
			position: relative;
			width: 100%;
			padding-top: 100%;
			overflow: hidden;
		}

		.npimg img {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}

		.nprice {
			font-size: 0.12rem;
			color: #f53c42;
			line-height: 1.5;
		}

		.titpr {
			white-space: normal;
			max-width: 100px;
			line-height: 1.5em;
			height:3em;
			word-break: break-all;
			margin-bottom: 5px;
			display: -webkit-box;
			-webkit-box-orient: vertical;
			-webkit-line-clamp: 2;
			overflow: hidden;

		}

		.titprg {
			display: block!important;
			width: 100%!important;
			max-width: none;
			height: auto
		}

		.mui-media {
			margin: 0 10px;
			display: inline-block!important;
			width: 25%;
		}
		.typeDis{margin-bottom: 10px;}
	</style>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="headbar mui-action-back mui-icon mui-icon-arrowdown mui-pull-left" style="background-color: #EEEEEE;border-radius: 50%;width: 35px!important;height: 35px;line-height: 35px!important;text-align: center;margin: 5px 10px!important;"></a>
			<h1 class="mui-title">活动促销</h1>
		</header>
		<script src="js/statusBar.js" type="text/javascript" charset="utf-8"></script>
		<div class="mui-content" style="padding-top: 50px;">
			<div id="classify"></div>
			<script type="text/html" id="classifyTpl">
				<%for(var i = 0 ;i < list.length ; i++){%>
				 <div class="typeDis" style="background-color: #fff;">
					<div class="imgpt aClick" onclick="goList(<%=list[i].promotionId%>,'<%=list[i].promotionTitle%>')">
						<img src="<%=list[i].picUrl || 'img/legray.svg'%>" alt="" />
						<div class="clasfyItem">
						 		<!--<div class="itemName"><%=list[i].promotionTitle%></div>-->
						 	</div>
						<div class="trangle"></div>
					</div>
					<div class="npbk">
						<div class="secClassfy">
							<ul class="" style="border-top: none!important;">
								<%if(list[i].goodsList.length){%>
									<%if(list[i].goodsList.length<=8){%>
										<%for(var j = 0 ; j < list[i].goodsList.length ; j++){%>
											<li class="mui-media bgcwt" onclick="goodsInfo(<%=list[i].goodsList[j].goodsId%>)">
												<a href="javascript:;" style="border-top: none!important;">
													<div class="zanwei zanweiY2">
														<img class="mui-media-object titprg" src="<%=list[i].goodsList[j].coverImageUri || 'img/editset.png'%>">
													</div>
													<div class="mui-media-body" style="font-size:12px">
														<div class="titcl ft14 titpr"><%=list[i].goodsList[j].skuName%></div>
														<!--<p class='ft14'>规格:xxx &nbsp;单位:xxx</p>-->
														<span class="activecl2 ft20">¥<%=list[i].goodsList[j].retailPrice%></span>
														<img style="display:inline-block;float:right;margin-right:5px;vertical-align:middle;width:28px" onclick="addcart(<%=list[i].goodsList[j].goodsId%>)" src="images/addcart.svg" />
													</div>
												</a>
											</li>
										<%}%>
									<%}else{%>
										<%for(var j = 0 ; j < 8 ; j++){%>
											<li class="mui-media bgcwt" onclick="goodsInfo(<%=list[i].goodsList[j].goodsId%>)">
												<a href="javascript:;" style="border-top: none!important;">
													<div class="zanwei zanweiY2">
														<img class="mui-media-object titprg" src="<%=list[i].goodsList[j].coverImageUri || 'img/editset.png'%>">
													</div>
													<div class="mui-media-body" style="font-size:12px">
														<div class="titcl ft14 titpr"><%=list[i].goodsList[j].skuName%></div>
														<!--<p class='ft14'>规格:xxx &nbsp;单位:xxx</p>-->
														<span class="activecl2 ft20">¥<%=list[i].goodsList[j].retailPrice%></span>
														<img style="display:inline-block;float:right;margin-right:5px;vertical-align:middle;width:28px" onclick="addcart(<%=list[i].goodsList[j].goodsId%>)" src="images/addcart.svg" />
													</div>
												</a>
											</li>
										<%}%>
									<%}%>
									<li class="mui-media bgcwt" style="vertical-align: top;" onclick="goList(<%=list[i].promotionId%>,'<%=list[i].promotionTitle%>')">
										<a href="javascript:;" style="border-top: none!important;">
											<div class="zanwei zanweiY2" style="margin-top: -10px;" style="background-color: #EEEEEE!important;">
												查看更多
											</div>

										</a>
									</li>
								<%}else{%>
									<div style="text-align:center;padding:20px;font-size: 12px;">暂无活动促销商品</div>
								<%}%>

							</ul>
						</div>
					</div>
				</div>
				<%}%>
			</script>
		</div>
		<!--<img id="close" src="images/order/closef.png" style="position: fixed;bottom: 10%;left: 50%;-webkit-transform: translateX(-50%);"/>-->
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/artTemplate-native.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/default.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init();
			$('#close').click(function() {
				plus.webview.currentWebview().close();
			})
			function goodsInfo(id) {
				openview({
					view: 'page/goodsInfo.html',
					id: 'goodsInfo',
					extrasobj: {
						goodId: id
					}
				})

			}
			function goList(listid,name) {
				openview({
					view: 'promotionInfo.html',
					id: 'promotionInfo',
					extrasobj: {
						listId: listid,
						listname: name
					}
				})

			}
			mui.plusReady(function(){
				plus.nativeUI.showWaiting();
				//加入购物车
				window.addcart = function(goodid) {
					event.stopPropagation();
					plus.nativeUI.showWaiting();
					mui.ajax(serverUrl + '/app/materialList/add', {
						data: {
							userId: userId,
							identityType: identityT,
							params: goodid + '-' + 1
						},
						dataType: 'json',
						headers: {
							"Authorization": oldToken
						},
						type: 'post',
						timeout: 10000,
						success: function(data, type, xhr) {
							plus.nativeUI.closeWaiting();
							console.log('加入购物车', data);
							if(data.code == 0) {
								plus.nativeUI.toast('加入成功')
								mui.fire(plus.webview.getWebviewById('cart.html'), 'refresh');

							} else {
								mui.toast(data.message)
							}

						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting();
							mui.toast(type)
							console.log('响应失败');
						}
					});
				}

				var identityT = JSON.parse(plus.storage.getItem("$identityType")).identityType;
				var userId = plus.storage.getItem('$userId');
				var oldToken = plus.storage.getItem('oldToken');
				mui.ajax(serverUrl+'/app/act/list',{
					data:{
						userId:userId,
						identityType:identityT,
					},
					dataType:'json',
					type:'post',
					timeout:10000,
					headers:{"Authorization":oldToken},
					success:function(data,type,xhr){
						plus.nativeUI.closeWaiting();
						console.log('活动促销',data);
				       	if(data.code == 0){
					     	if(data.content && data.content.length){
					     	  $('#classify').html(template('classifyTpl', {list:data.content}));
							}else{
								$('#classify').html('<div style="text-align:center;padding:15px;font-size: 12px;">暂无活动促销</div>')
							}
				       	}
				       	plus.nativeUI.closeWaiting();
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.closeWaiting();
						mui.alert('当前网络不好,请重试');
					}
				});

			})
		</script>
	</body>

</html>